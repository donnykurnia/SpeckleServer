{"remainingRequest":"/Users/donnykurnia/data/Projects/upwork/3dbyggeri/glasshouse/SpeckleServer/plugins/admin/node_modules/thread-loader/dist/cjs.js!/Users/donnykurnia/data/Projects/upwork/3dbyggeri/glasshouse/SpeckleServer/plugins/admin/node_modules/babel-loader/lib/index.js!/Users/donnykurnia/data/Projects/upwork/3dbyggeri/glasshouse/SpeckleServer/plugins/admin/node_modules/cache-loader/dist/cjs.js??ref--0-0!/Users/donnykurnia/data/Projects/upwork/3dbyggeri/glasshouse/SpeckleServer/plugins/admin/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/donnykurnia/data/Projects/upwork/3dbyggeri/glasshouse/SpeckleServer/plugins/admin/src/components/ViewerLoadedStreamsCard.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/donnykurnia/data/Projects/upwork/3dbyggeri/glasshouse/SpeckleServer/plugins/admin/src/components/ViewerLoadedStreamsCard.vue","mtime":1609071089417},{"path":"/Users/donnykurnia/data/Projects/upwork/3dbyggeri/glasshouse/SpeckleServer/plugins/admin/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/donnykurnia/data/Projects/upwork/3dbyggeri/glasshouse/SpeckleServer/plugins/admin/node_modules/thread-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/donnykurnia/data/Projects/upwork/3dbyggeri/glasshouse/SpeckleServer/plugins/admin/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/donnykurnia/data/Projects/upwork/3dbyggeri/glasshouse/SpeckleServer/plugins/admin/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/donnykurnia/data/Projects/upwork/3dbyggeri/glasshouse/SpeckleServer/plugins/admin/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["import \"core-js/modules/es6.function.name\";\nimport _JSON$stringify from \"/Users/donnykurnia/data/Projects/upwork/3dbyggeri/glasshouse/SpeckleServer/plugins/admin/node_modules/@babel/runtime-corejs2/core-js/json/stringify\";\nimport \"core-js/modules/es6.regexp.replace\";\nimport \"regenerator-runtime/runtime\";\nimport _asyncToGenerator from \"/Users/donnykurnia/data/Projects/upwork/3dbyggeri/glasshouse/SpeckleServer/plugins/admin/node_modules/@babel/runtime-corejs2/helpers/esm/asyncToGenerator\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport sockette from 'sockette';\nexport default {\n  name: 'ViewerStreamCard',\n  props: {\n    stream: Object\n  },\n  computed: {},\n  data: function data() {\n    return {\n      isExpired: false\n    };\n  },\n  methods: {\n    refreshStream: function refreshStream() {\n      this.isExpired = false;\n      this.$emit(\"refresh\", this.stream.streamId);\n    },\n    initSocket: function () {\n      var _initSocket = _asyncToGenerator(\n      /*#__PURE__*/\n      regeneratorRuntime.mark(function _callee() {\n        return regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee);\n      }));\n\n      function initSocket() {\n        return _initSocket.apply(this, arguments);\n      }\n\n      return initSocket;\n    }()\n  },\n  mounted: function () {\n    var _mounted = _asyncToGenerator(\n    /*#__PURE__*/\n    regeneratorRuntime.mark(function _callee2() {\n      var _this = this;\n\n      var wsUrl;\n      return regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              wsUrl = this.$store.state.server.replace('http', 'ws').replace('/api', '');\n\n              if (this.$store.state.client) {\n                _context2.next = 4;\n                break;\n              }\n\n              _context2.next = 4;\n              return this.$store.dispatch('createClient');\n\n            case 4:\n              this.ws = new sockette(\"\".concat(wsUrl, \"?client_id=\").concat(this.$store.state.client._id), {\n                onopen: function onopen(e) {\n                  _this.ws.send(_JSON$stringify({\n                    eventName: \"join\",\n                    resourceId: _this.stream.streamId,\n                    resourceType: \"stream\"\n                  }));\n                },\n                onmessage: function onmessage(e) {\n                  // console.log( e )\n                  if (e.data === 'ping') {\n                    _this.ws.send('alive');\n\n                    return;\n                  }\n\n                  var parsedMessage = JSON.parse(e.data);\n                  console.log(parsedMessage);\n\n                  try {\n                    if (parsedMessage.args.eventType === \"update-global\") {\n                      _this.isExpired = true;\n                    }\n                  } catch (err) {}\n                },\n                onclose: function onclose(e) {\n                  console.log(e);\n                },\n                onerror: function onerror(e) {\n                  console.warn(e);\n                }\n              });\n\n            case 5:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2, this);\n    }));\n\n    function mounted() {\n      return _mounted.apply(this, arguments);\n    }\n\n    return mounted;\n  }(),\n  destroyed: function destroyed() {\n    console.log('stream render card destroyed ' + this.stream.name + \" \" + this.stream.streamId);\n    this.ws.close();\n  }\n};",{"version":3,"sources":["ViewerLoadedStreamsCard.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;AAuBA,OAAA,QAAA,MAAA,UAAA;AAEA,eAAA;AACA,EAAA,IAAA,EAAA,kBADA;AAEA,EAAA,KAAA,EAAA;AACA,IAAA,MAAA,EAAA;AADA,GAFA;AAKA,EAAA,QAAA,EAAA,EALA;AAMA,EAAA,IANA,kBAMA;AACA,WAAA;AACA,MAAA,SAAA,EAAA;AADA,KAAA;AAGA,GAVA;AAWA,EAAA,OAAA,EAAA;AACA,IAAA,aADA,2BACA;AACA,WAAA,SAAA,GAAA,KAAA;AACA,WAAA,KAAA,CAAA,SAAA,EAAA,KAAA,MAAA,CAAA,QAAA;AACA,KAJA;AAKA,IAAA,UALA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA,GAXA;AAkBA,EAAA,OAlBA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAmBA,cAAA,KAnBA,GAmBA,KAAA,MAAA,CAAA,KAAA,CAAA,MAAA,CAAA,OAAA,CAAA,MAAA,EAAA,IAAA,EAAA,OAAA,CAAA,MAAA,EAAA,EAAA,CAnBA;;AAAA,kBAoBA,KAAA,MAAA,CAAA,KAAA,CAAA,MApBA;AAAA;AAAA;AAAA;;AAAA;AAAA,qBAqBA,KAAA,MAAA,CAAA,QAAA,CAAA,cAAA,CArBA;;AAAA;AAsBA,mBAAA,EAAA,GAAA,IAAA,QAAA,WAAA,KAAA,wBAAA,KAAA,MAAA,CAAA,KAAA,CAAA,MAAA,CAAA,GAAA,GAAA;AACA,gBAAA,MAAA,EAAA,gBAAA,CAAA,EAAA;AACA,kBAAA,KAAA,CAAA,EAAA,CAAA,IAAA,CAAA,gBAAA;AAAA,oBAAA,SAAA,EAAA,MAAA;AAAA,oBAAA,UAAA,EAAA,KAAA,CAAA,MAAA,CAAA,QAAA;AAAA,oBAAA,YAAA,EAAA;AAAA,mBAAA,CAAA;AACA,iBAHA;AAIA,gBAAA,SAAA,EAAA,mBAAA,CAAA,EAAA;AACA;AACA,sBAAA,CAAA,CAAA,IAAA,KAAA,MAAA,EAAA;AACA,oBAAA,KAAA,CAAA,EAAA,CAAA,IAAA,CAAA,OAAA;;AACA;AACA;;AACA,sBAAA,aAAA,GAAA,IAAA,CAAA,KAAA,CAAA,CAAA,CAAA,IAAA,CAAA;AACA,kBAAA,OAAA,CAAA,GAAA,CAAA,aAAA;;AACA,sBAAA;AACA,wBAAA,aAAA,CAAA,IAAA,CAAA,SAAA,KAAA,eAAA,EAAA;AACA,sBAAA,KAAA,CAAA,SAAA,GAAA,IAAA;AACA;AACA,mBAJA,CAIA,OAAA,GAAA,EAAA,CAAA;AACA,iBAjBA;AAkBA,gBAAA,OAAA,EAAA,iBAAA,CAAA,EAAA;AACA,kBAAA,OAAA,CAAA,GAAA,CAAA,CAAA;AACA,iBApBA;AAqBA,gBAAA,OAAA,EAAA,iBAAA,CAAA,EAAA;AACA,kBAAA,OAAA,CAAA,IAAA,CAAA,CAAA;AACA;AAvBA,eAAA,CAAA;;AAtBA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAgDA,EAAA,SAhDA,uBAgDA;AACA,IAAA,OAAA,CAAA,GAAA,CAAA,kCAAA,KAAA,MAAA,CAAA,IAAA,GAAA,GAAA,GAAA,KAAA,MAAA,CAAA,QAAA;AACA,SAAA,EAAA,CAAA,KAAA;AACA;AAnDA,CAAA","sourcesContent":["<template>\n  <v-card :class='`mb-3 ${ isExpired ? \"expired\" : \"current\"}`'>\n    <v-card-text>\n      <v-layout row wrap>\n        <v-flex xs12>{{stream.name}}</v-flex>\n        <v-flex xs12 class='caption'>\n          <v-icon small>fingerprint</v-icon> {{stream.streamId}}\n          <v-icon small>{{stream.private ? \"lock\" : \"lock_open\"}}</v-icon>\n          last changed <timeago :datetime='stream.updatedAt'></timeago>, created on {{new Date( stream.createdAt ).toLocaleString()}}\n        </v-flex>\n        <v-flex xs12 class='caption' v-if='isExpired'>\n          <v-divider class='my-2'></v-divider>\n          This stream has expired; data was updated.\n        </v-flex>\n      </v-layout>\n    </v-card-text>\n    <v-card-actions>\n      <v-btn flat small @click='$emit(\"remove\", stream.streamId)'>remove</v-btn>\n      <v-btn v-if='isExpired' small @click='refreshStream()'>refresh</v-btn>\n    </v-card-actions>\n  </v-card>\n</template>\n<script>\nimport sockette from 'sockette'\n\nexport default {\n  name: 'ViewerStreamCard',\n  props: {\n    stream: Object\n  },\n  computed: {},\n  data( ) {\n    return {\n      isExpired: false\n    }\n  },\n  methods: {\n    refreshStream( ) {\n      this.isExpired = false\n      this.$emit( \"refresh\", this.stream.streamId )\n    },\n    async initSocket( ) {}\n  },\n  async mounted( ) {\n    let wsUrl = this.$store.state.server.replace( 'http', 'ws' ).replace( '/api', '' )\n    if ( !this.$store.state.client )\n      await this.$store.dispatch( 'createClient' )\n    this.ws = new sockette( `${wsUrl}?client_id=${this.$store.state.client._id}`, {\n      onopen: e => {\n        this.ws.send( JSON.stringify( { eventName: \"join\", resourceId: this.stream.streamId, resourceType: \"stream\" } ) )\n      },\n      onmessage: e => {\n        // console.log( e )\n        if ( e.data === 'ping' ) {\n          this.ws.send( 'alive' )\n          return\n        }\n        let parsedMessage = JSON.parse( e.data )\n        console.log( parsedMessage )\n        try {\n          if ( parsedMessage.args.eventType === \"update-global\" ) {\n            this.isExpired = true\n          }\n        } catch ( err ) {}\n      },\n      onclose: e => {\n        console.log( e )\n      },\n      onerror: e => {\n        console.warn( e )\n      }\n    } )\n  },\n  destroyed( ) {\n    console.log( 'stream render card destroyed ' + this.stream.name + \" \" + this.stream.streamId )\n    this.ws.close( )\n  }\n}\n\n</script>\n<style scoped lang='scss'>\n.current {\n  border-left: 4px solid #0A66FF;\n}\n\n.expired {\n  border-left: 4px solid #FF0A6D;\n}\n\n</style>\n"],"sourceRoot":"src/components"}]}