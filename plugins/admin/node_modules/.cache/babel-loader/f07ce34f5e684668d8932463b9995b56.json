{"remainingRequest":"/Users/donnykurnia/data/Projects/upwork/3dbyggeri/glasshouse/SpeckleServer/plugins/admin/node_modules/thread-loader/dist/cjs.js!/Users/donnykurnia/data/Projects/upwork/3dbyggeri/glasshouse/SpeckleServer/plugins/admin/node_modules/babel-loader/lib/index.js!/Users/donnykurnia/data/Projects/upwork/3dbyggeri/glasshouse/SpeckleServer/plugins/admin/node_modules/cache-loader/dist/cjs.js??ref--0-0!/Users/donnykurnia/data/Projects/upwork/3dbyggeri/glasshouse/SpeckleServer/plugins/admin/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/donnykurnia/data/Projects/upwork/3dbyggeri/glasshouse/SpeckleServer/plugins/admin/src/components/PermissionTable.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/donnykurnia/data/Projects/upwork/3dbyggeri/glasshouse/SpeckleServer/plugins/admin/src/components/PermissionTable.vue","mtime":1609071089409},{"path":"/Users/donnykurnia/data/Projects/upwork/3dbyggeri/glasshouse/SpeckleServer/plugins/admin/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/donnykurnia/data/Projects/upwork/3dbyggeri/glasshouse/SpeckleServer/plugins/admin/node_modules/thread-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/donnykurnia/data/Projects/upwork/3dbyggeri/glasshouse/SpeckleServer/plugins/admin/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/donnykurnia/data/Projects/upwork/3dbyggeri/glasshouse/SpeckleServer/plugins/admin/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/donnykurnia/data/Projects/upwork/3dbyggeri/glasshouse/SpeckleServer/plugins/admin/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["import \"core-js/modules/es6.function.name\";\nimport \"core-js/modules/es6.array.find\";\nimport \"core-js/modules/es6.array.sort\";\nimport _toConsumableArray from \"/Users/donnykurnia/data/Projects/upwork/3dbyggeri/glasshouse/SpeckleServer/plugins/admin/node_modules/@babel/runtime-corejs2/helpers/esm/toConsumableArray\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport union from 'lodash.union';\nimport uniq from 'lodash.uniq';\nexport default {\n  name: 'PermissionTable',\n  props: {\n    resource: Object,\n    globalDisabled: {\n      type: Boolean,\n      default: false\n    },\n    disabledUsers: {\n      type: Array,\n      default: function _default() {\n        return [];\n      }\n    }\n  },\n  computed: {\n    canRead: function canRead() {\n      return [].concat(_toConsumableArray(this.resource.canRead), [this.resource.owner]);\n    },\n    canWrite: function canWrite() {\n      return [].concat(_toConsumableArray(this.resource.canWrite), [, this.resource.owner]);\n    },\n    allUsers: function allUsers() {\n      return union(this.canRead, this.canWrite, [this.resource.owner]);\n    },\n    allUsersPop: function allUsersPop() {\n      var _this = this;\n\n      if (this.allUsers.length === 0) return [];\n      return this.allUsers.map(function (userId) {\n        if (!userId) {} else {\n          var u = _this.$store.state.users.find(function (user) {\n            return user._id === userId;\n          });\n\n          if (!u) _this.$store.dispatch('getUser', {\n            _id: userId\n          });\n          if (u) u.isOwner = u._id === _this.resource.owner;\n          return u;\n        }\n      }).sort(function (a, b) {\n        return a.name > b.name ? 1 : -1;\n      });\n    }\n  },\n  data: function data() {\n    return {};\n  },\n  methods: {\n    isDisabled: function isDisabled(_id) {\n      return this.disabledUsers.indexOf(_id) > -1;\n    },\n    hasWritePermission: function hasWritePermission(_id) {\n      return this.canWrite.indexOf(_id) > -1;\n    },\n    changePermission: function changePermission(_id) {\n      var localCanWrite = [],\n          localCanRead = []; // check in which perm cat the user is right now\n\n      var index = this.canWrite.indexOf(_id); // canWrite -> canRead\n\n      if (index > -1) {\n        localCanWrite = this.canWrite.filter(function (uId) {\n          return uId !== _id;\n        });\n        localCanRead = uniq([].concat(_toConsumableArray(this.canRead), [_id])); // this.$emit('move-user')\n        // TODO: this.$emit('move-user', { userId:x, from:'W->R' }) // for projects\n        // canRead -> canWrite\n      } else {\n        localCanRead = this.canRead.filter(function (uId) {\n          return uId !== _id;\n        });\n        localCanWrite = uniq([].concat(_toConsumableArray(this.canWrite), [_id])); // TODO: this.$emit('move-user', { userId:x, from:'R->W' }) // for projects\n      } // emit one global event\n\n\n      this.$emit('update-table', {\n        canRead: localCanRead,\n        canWrite: localCanWrite\n      });\n    },\n    removeUser: function removeUser(_id) {\n      var localCanWrite = this.canWrite.filter(function (uId) {\n        return uId !== _id;\n      });\n      var localCanRead = this.canRead.filter(function (uId) {\n        return uId !== _id;\n      });\n      this.$emit('remove-user', {\n        userId: _id\n      });\n      this.$emit('update-table', {\n        canRead: localCanRead,\n        canWrite: localCanWrite\n      });\n    }\n  },\n  mounted: function mounted() {}\n};",{"version":3,"sources":["PermissionTable.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\n  <v-container grid-list-xl v-if='allUsersPop.length > 0' class='pa-0 ma-0'>\n    <v-layout row wrap>\n      <v-flex xs12 sm6 lg4 v-for='user in allUsersPop' v-if='user' :key='user._id'>\n        <v-card tile class='pa-3 elevation-1'>\n          <v-layout row wrap align-center justify-space-between>\n            <v-flex xs8>\n              <v-avatar size='21' dark :color=\"getHexFromString( user.name )\">\n                {{user.name.substring(0,1).toUpperCase()}}\n              </v-avatar>&nbsp;\n              <span>{{user.name}} {{user.surname}}</span>&nbsp;\n              <span class='caption'>{{user.company}}</span>\n            </v-flex>\n            <v-flex xs4 class='text-xs-right'>\n              <v-btn depressed :color='hasWritePermission(user._id)?\"primary\":\"\"' @click.native='changePermission(user._id)' :disabled='user.surname.includes(`(that is you!)`) || globalDisabled || isDisabled(user._id)'>{{hasWritePermission(user._id) ? \"edit\" : \"view\"}}</v-btn>\n              <v-btn depressed @click.native='removeUser(user._id)' :disabled='user.surname.includes(`(that is you!)`) || globalDisabled || isDisabled(user._id)'>\n                <v-icon>close</v-icon>\n              </v-btn>\n            </v-flex>\n          </v-layout>\n        </v-card>\n      </v-flex>\n    </v-layout>\n  </v-container>\n</template>\n<script>\nimport union from 'lodash.union'\nimport uniq from 'lodash.uniq'\n\nexport default {\n  name: 'PermissionTable',\n  props: {\n    resource: Object,\n    globalDisabled: {\n      type: Boolean,\n      default: false\n    },\n    disabledUsers: {\n      type: Array,\n      default: ( ) => [ ]\n    }\n  },\n  computed: {\n    canRead( ) { return [ ...this.resource.canRead, this.resource.owner ] },\n    canWrite( ) { return [ ...this.resource.canWrite, , this.resource.owner ] },\n    allUsers( ) {\n      return union( this.canRead, this.canWrite, [ this.resource.owner ] )\n    },\n    allUsersPop( ) {\n      if ( this.allUsers.length === 0 ) return [ ]\n      return this.allUsers.map( userId => {\n        if ( !userId ) {} else {\n          let u = this.$store.state.users.find( user => user._id === userId )\n          if ( !u ) this.$store.dispatch( 'getUser', { _id: userId } )\n          if ( u ) u.isOwner = u._id === this.resource.owner\n          return u\n        }\n      } ).sort( ( a, b ) => a.name > b.name ? 1 : -1 )\n    }\n  },\n  data( ) {\n    return {}\n  },\n  methods: {\n    isDisabled( _id ) {\n      return this.disabledUsers.indexOf( _id ) > -1\n    },\n    hasWritePermission( _id ) {\n      return this.canWrite.indexOf( _id ) > -1\n    },\n    changePermission( _id ) {\n      let localCanWrite = [ ],\n        localCanRead = [ ]\n\n      // check in which perm cat the user is right now\n      let index = this.canWrite.indexOf( _id )\n\n      // canWrite -> canRead\n      if ( index > -1 ) {\n        localCanWrite = this.canWrite.filter( uId => uId !== _id )\n        localCanRead = uniq( [ ...this.canRead, _id ] )\n        // this.$emit('move-user')\n        // TODO: this.$emit('move-user', { userId:x, from:'W->R' }) // for projects\n        // canRead -> canWrite\n      } else {\n        localCanRead = this.canRead.filter( uId => uId !== _id )\n        localCanWrite = uniq( [ ...this.canWrite, _id ] )\n        // TODO: this.$emit('move-user', { userId:x, from:'R->W' }) // for projects\n      }\n\n      // emit one global event\n      this.$emit( 'update-table', { canRead: localCanRead, canWrite: localCanWrite } )\n    },\n    removeUser( _id ) {\n      let localCanWrite = this.canWrite.filter( uId => uId !== _id )\n      let localCanRead = this.canRead.filter( uId => uId !== _id )\n      this.$emit( 'remove-user', { userId: _id } )\n      this.$emit( 'update-table', { canRead: localCanRead, canWrite: localCanWrite } )\n    }\n  },\n  mounted( ) {}\n}\n\n</script>\n<style scoped lang='scss'>\n.user {\n  padding: 2px 10px;\n}\n\n</style>\n"],"sourceRoot":"src/components"}]}