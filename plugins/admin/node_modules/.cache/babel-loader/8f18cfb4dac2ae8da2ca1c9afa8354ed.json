{"remainingRequest":"/Users/donnykurnia/data/Projects/upwork/3dbyggeri/glasshouse/SpeckleServer/plugins/admin/node_modules/thread-loader/dist/cjs.js!/Users/donnykurnia/data/Projects/upwork/3dbyggeri/glasshouse/SpeckleServer/plugins/admin/node_modules/babel-loader/lib/index.js!/Users/donnykurnia/data/Projects/upwork/3dbyggeri/glasshouse/SpeckleServer/plugins/admin/node_modules/cache-loader/dist/cjs.js??ref--0-0!/Users/donnykurnia/data/Projects/upwork/3dbyggeri/glasshouse/SpeckleServer/plugins/admin/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/donnykurnia/data/Projects/upwork/3dbyggeri/glasshouse/SpeckleServer/plugins/admin/src/views/StreamData.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/donnykurnia/data/Projects/upwork/3dbyggeri/glasshouse/SpeckleServer/plugins/admin/src/views/StreamData.vue","mtime":1609071089434},{"path":"/Users/donnykurnia/data/Projects/upwork/3dbyggeri/glasshouse/SpeckleServer/plugins/admin/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/donnykurnia/data/Projects/upwork/3dbyggeri/glasshouse/SpeckleServer/plugins/admin/node_modules/thread-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/donnykurnia/data/Projects/upwork/3dbyggeri/glasshouse/SpeckleServer/plugins/admin/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/donnykurnia/data/Projects/upwork/3dbyggeri/glasshouse/SpeckleServer/plugins/admin/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/donnykurnia/data/Projects/upwork/3dbyggeri/glasshouse/SpeckleServer/plugins/admin/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["import \"core-js/modules/es6.array.find\";\nimport \"core-js/modules/es6.regexp.to-string\";\nimport \"core-js/modules/es6.function.name\";\nimport \"core-js/modules/web.dom.iterable\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport debounce from 'lodash.debounce';\nimport union from 'lodash.union';\nimport Axios from 'axios';\nimport uuid from 'uuid/v4';\nimport papa from 'papaparse';\nimport StreamLayer from '../components/StreamLayer.vue';\nexport default {\n  name: 'StreamEditView',\n  components: {\n    StreamLayer: StreamLayer\n  },\n  watch: {\n    stream: function stream(newStream, oldStream) {\n      this.fetchData(newStream.streamId);\n    }\n  },\n  computed: {\n    // fed to the stream layers component\n    mergedLayers: function mergedLayers() {\n      var _this = this;\n\n      if (!this.deStream) return [];\n      var mergedLayers = [];\n      this.deStream.layers.forEach(function (l) {\n        mergedLayers.push({\n          name: l.name,\n          isArray: true,\n          startIndex: l.startIndex,\n          objectCount: l.objectCount,\n          guid: l.guid,\n          topology: l.topology,\n          objects: _this.deStream.objects.slice(l.startIndex, l.startIndex + l.objectCount).map(function (o) {\n            return o.value.toString();\n          })\n        });\n      });\n      return mergedLayers;\n    },\n    deStream: function deStream() {\n      var _this2 = this;\n\n      return this.$store.state.deStreams.find(function (s) {\n        return s.streamId === _this2.$route.params.streamId;\n      });\n    },\n    stream: function stream() {\n      var _this3 = this;\n\n      return this.$store.state.streams.find(function (s) {\n        return s.streamId === _this3.$route.params.streamId;\n      });\n    },\n    canEdit: function canEdit() {\n      return this.isOwner ? true : this.stream.canWrite.indexOf(this.$store.state.user._id) !== -1;\n    },\n    isOwner: function isOwner() {\n      return this.stream.owner === this.$store.state.user._id;\n    },\n    onlineEditable: function onlineEditable() {\n      return this.stream.onlineEditable ? this.stream.onlineEditable : false;\n    }\n  },\n  data: function data() {\n    return {\n      changed: false,\n      showSaveDialog: false,\n      commitMessage: 'no message',\n      showImportCSVDialog: false,\n      csvInput: '',\n      isLoading: false,\n      isGettingStreamData: false\n    };\n  },\n  methods: {\n    updateLayer: function updateLayer(_ref) {\n      var layer = _ref.layer,\n          objects = _ref.objects;\n      this.$store.commit('UPDATE_DE_STREAM_LAYER', {\n        streamId: this.stream.streamId,\n        layer: layer,\n        objects: objects\n      });\n      this.changed = true;\n    },\n    addLayer: function addLayer() {\n      this.$store.commit('ADD_DE_STREAM_LAYER', {\n        streamId: this.stream.streamId\n      });\n      this.changed = true;\n    },\n    removeLayer: function removeLayer(layer) {\n      this.$store.commit('REMOVE_DE_STREAM_LAYER', {\n        streamId: this.stream.streamId,\n        layer: layer\n      });\n      this.changed = true;\n    },\n    preSaveData: function preSaveData() {\n      this.showSaveDialog = true;\n    },\n    saveData: function saveData() {\n      var _this4 = this;\n\n      this.isLoading = true;\n      this.$store.dispatch('updateStreamObjectsAndLayers', {\n        streamId: this.stream.streamId,\n        commitMessage: this.commitMessage\n      }).then(function (res) {\n        _this4.showSaveDialog = false;\n        _this4.commitMessage = 'no message';\n        _this4.changed = false;\n        _this4.isLoading = false;\n        console.log(res);\n      }).catch(function (err) {\n        // TODO: handle error\n        _this4.isLoading = false;\n        console.error(err);\n      });\n    },\n    fetchData: function fetchData(streamId) {\n      var _this5 = this;\n\n      if (!this.onlineEditable) return;\n      console.log(\"fetching data for \".concat(streamId));\n      this.isGettingStreamData = true;\n      Axios.get(\"streams/\".concat(streamId, \"?fields=layers\")).then(function (res) {\n        _this5.layers = res.data.resource.layers;\n        console.log(_this5.layers);\n        return Axios.get(\"streams/\".concat(streamId, \"/objects?fields=type,value\"));\n      }).then(function (res) {\n        _this5.objects = res.data.resources;\n\n        _this5.$store.commit('ADD_DE_STREAM', {\n          streamId: streamId,\n          layers: _this5.layers,\n          objects: _this5.objects\n        });\n\n        _this5.isGettingStreamData = false;\n        console.log(res);\n      }).catch(function (err) {\n        _this5.isGettingStreamData = false; // TODO: Handle error\n\n        console.error(err);\n      });\n    },\n    importCSV: function importCSV() {\n      this.isLoading = true;\n      var results = papa.parse(this.csvInput, {\n        dynamicTyping: false\n      }); // console.log( results )\n\n      var transposed = results.data[0].map(function (x, i) {\n        return results.data.map(function (x) {\n          return x[i];\n        });\n      }); // console.log( transposed )\n\n      this.$store.commit('APPEND_DE_STREAM_LAYERS_FROM_CSV', {\n        streamId: this.stream.streamId,\n        transposed: transposed\n      });\n      this.showImportCSVDialog = false;\n      this.csvInput = '';\n      this.changed = true;\n      this.isLoading = false;\n    },\n    closeCsvDialog: function closeCsvDialog() {\n      this.showImportCSVDialog = false;\n      this.csvInput = '';\n    }\n  },\n  mounted: function mounted() {\n    var _this6 = this;\n\n    console.log('hello data');\n    var stream = this.$store.state.streams.find(function (s) {\n      return s.streamId === _this6.$route.params.streamId;\n    });\n    this.fetchData(this.$route.params.streamId);\n  }\n};",{"version":3,"sources":["StreamData.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\n  <v-layout row wrap>\n    <v-flex xs12 v-if='!onlineEditable'>\n      <v-alert type='warning' :value=\"!onlineEditable\">\n        This stream is not marked as online editable.\n      </v-alert>\n    </v-flex>\n    <v-flex xs12>\n      <v-progress-linear :indeterminate=\"true\" v-if='isGettingStreamData'></v-progress-linear>\n    </v-flex>\n    <v-flex xs12>\n      <v-card class='elevation-0 pt-4'>\n        <v-toolbar dense class='elevation-0 transparent'>\n          <v-icon small left>business</v-icon>&nbsp;\n          <span class='title font-weight-light'>Data</span>\n          <v-spacer></v-spacer>\n          <v-toolbar-items>\n            <v-btn depressed small flat @click.native='showImportCSVDialog = true' :disabled='!onlineEditable'>\n              <v-icon>cloud_upload</v-icon>\n              &nbsp;&nbsp;Import CSV\n            </v-btn>\n            <v-btn color='primary' small depressed @click.native='preSaveData()' :disabled='!changed || !onlineEditable'>\n              save\n            </v-btn>\n          </v-toolbar-items>\n        </v-toolbar>\n        <v-card-text>\n          <v-layout row wrap>\n            <v-flex xs12>\n              <stream-layer v-for='layer in mergedLayers' :key='layer.guid' :layer='layer' @update='updateLayer' @remove='removeLayer'>\n              </stream-layer>\n            </v-flex>\n            <v-flex xs12>\n              <v-btn block @click.native='addLayer' :disabled='!onlineEditable'>\n                <v-icon>add</v-icon>\n                add a layer\n              </v-btn>\n            </v-flex>\n            <v-flex xs12>\n            </v-flex>\n          </v-layout>\n        </v-card-text>\n      </v-card>\n    </v-flex>\n    <v-dialog v-model=\"showSaveDialog\" width=\"500\">\n      <v-card>\n        <v-card-title class=\"headline\" primary-title>\n          Commit message\n        </v-card-title>\n        <v-card-text>\n          <p>Write a short description of the reasons behind the changes you just made.</p>\n          <v-text-field box v-model='commitMessage'></v-text-field>\n        </v-card-text>\n        <v-divider></v-divider>\n        <v-card-actions>\n          <v-spacer></v-spacer>\n          <v-btn flat @click='showSaveDialog=false'>\n            cancel\n          </v-btn>\n          <v-btn color=\"primary\" @click=\"saveData()\" :loading='isLoading' :disabled='isLoading'>\n            Save\n          </v-btn>\n        </v-card-actions>\n      </v-card>\n    </v-dialog>\n    <!-- CSV -->\n    <v-dialog v-model='showImportCSVDialog' width=\"500\">\n      <v-card>\n        <v-card-title class=\"headline\" primary-title>\n          CSV Import\n        </v-card-title>\n        <v-card-text>\n          <p>Paste your csv below.</p>\n          <p class='md-caption'>We assume the first row will contain the column names. Each column will become a separate \"output port\" or layer.</p>\n          <v-textarea box style=\"height: 150px;width:100%\" v-model='csvInput'></v-textarea>\n        </v-card-text>\n        <v-card-actions>\n          <v-spacer></v-spacer>\n          <v-btn flat @click='closeCsvDialog()'>Cancel</v-btn>\n          <v-btn color=\"primary\" @click='importCSV()' :loading='isLoading' :disabled='isLoading'>Import CSV</v-btn>\n        </v-card-actions>\n      </v-card>\n    </v-dialog>\n  </v-layout>\n</template>\n<script>\nimport debounce from 'lodash.debounce'\nimport union from 'lodash.union'\nimport Axios from 'axios'\nimport uuid from 'uuid/v4'\nimport papa from 'papaparse'\n\nimport StreamLayer from '../components/StreamLayer.vue'\n\nexport default {\n  name: 'StreamEditView',\n  components: {\n    StreamLayer\n  },\n  watch: {\n    stream( newStream, oldStream ) {\n      this.fetchData( newStream.streamId )\n    }\n  },\n  computed: {\n    // fed to the stream layers component\n    mergedLayers( ) {\n      if ( !this.deStream ) return [ ]\n      let mergedLayers = [ ]\n      this.deStream.layers.forEach( l => {\n        mergedLayers.push( {\n          name: l.name,\n          isArray: true,\n          startIndex: l.startIndex,\n          objectCount: l.objectCount,\n          guid: l.guid,\n          topology: l.topology,\n          objects: this.deStream.objects.slice( l.startIndex, l.startIndex + l.objectCount ).map( o => o.value.toString( ) )\n        } )\n      } )\n      return mergedLayers\n    },\n    deStream( ) {\n      return this.$store.state.deStreams.find( s => s.streamId === this.$route.params.streamId )\n    },\n    stream( ) {\n      return this.$store.state.streams.find( s => s.streamId === this.$route.params.streamId )\n    },\n    canEdit( ) {\n      return this.isOwner ? true : this.stream.canWrite.indexOf( this.$store.state.user._id ) !== -1\n    },\n    isOwner( ) {\n      return this.stream.owner === this.$store.state.user._id\n    },\n    onlineEditable( ) {\n      return this.stream.onlineEditable ? this.stream.onlineEditable : false\n    }\n  },\n  data( ) {\n    return {\n      changed: false,\n      showSaveDialog: false,\n      commitMessage: 'no message',\n      showImportCSVDialog: false,\n      csvInput: '',\n      isLoading: false,\n      isGettingStreamData: false,\n    }\n  },\n  methods: {\n    updateLayer( { layer, objects } ) {\n      this.$store.commit( 'UPDATE_DE_STREAM_LAYER', { streamId: this.stream.streamId, layer, objects } )\n      this.changed = true\n    },\n    addLayer( ) {\n      this.$store.commit( 'ADD_DE_STREAM_LAYER', { streamId: this.stream.streamId } )\n      this.changed = true\n    },\n    removeLayer( layer ) {\n      this.$store.commit( 'REMOVE_DE_STREAM_LAYER', { streamId: this.stream.streamId, layer: layer } )\n      this.changed = true\n    },\n    preSaveData( ) {\n      this.showSaveDialog = true\n    },\n    saveData( ) {\n      this.isLoading = true\n      this.$store.dispatch( 'updateStreamObjectsAndLayers', { streamId: this.stream.streamId, commitMessage: this.commitMessage } )\n        .then( res => {\n          this.showSaveDialog = false\n          this.commitMessage = 'no message'\n          this.changed = false\n          this.isLoading = false\n          console.log( res )\n        } )\n        .catch( err => {\n          // TODO: handle error\n          this.isLoading = false\n          console.error( err )\n        } )\n    },\n    fetchData( streamId ) {\n      if(!this.onlineEditable) return\n      console.log( `fetching data for ${streamId}` )\n      this.isGettingStreamData = true\n      Axios.get( `streams/${streamId}?fields=layers` )\n        .then( res => {\n          this.layers = res.data.resource.layers\n          console.log( this.layers )\n          return Axios.get( `streams/${streamId}/objects?fields=type,value` )\n        } )\n        .then( res => {\n          this.objects = res.data.resources\n          this.$store.commit( 'ADD_DE_STREAM', { streamId: streamId, layers: this.layers, objects: this.objects } )\n          this.isGettingStreamData = false\n\n          console.log( res )\n        } )\n        .catch( err => {\n          this.isGettingStreamData = false\n          // TODO: Handle error\n          console.error( err )\n        } )\n    },\n    importCSV( ) {\n      this.isLoading = true\n      let results = papa.parse( this.csvInput, { dynamicTyping: false } )\n      // console.log( results )\n      let transposed = results.data[ 0 ].map( ( x, i ) => results.data.map( x => x[ i ] ) )\n      // console.log( transposed )\n      this.$store.commit( 'APPEND_DE_STREAM_LAYERS_FROM_CSV', { streamId: this.stream.streamId, transposed } )\n      this.showImportCSVDialog = false\n      this.csvInput = ''\n      this.changed = true\n      this.isLoading = false\n    },\n    closeCsvDialog( ) {\n      this.showImportCSVDialog = false\n      this.csvInput = ''\n    }\n  },\n  mounted( ) {\n    console.log( 'hello data' )\n    let stream = this.$store.state.streams.find( s => s.streamId === this.$route.params.streamId )\n    this.fetchData( this.$route.params.streamId )\n  }\n}\n\n</script>\n<style scoped lang='scss'>\n.detail-card {\n  margin-bottom: 20px;\n}\n\n.md-content {\n  padding: 30px;\n  display: inline-flex;\n  justify-content: center;\n  align-items: center;\n}\n\n.md-card-content {\n  padding: 0;\n}\n\na:hover {\n  cursor: pointer;\n}\n\n</style>\n"],"sourceRoot":"src/views"}]}