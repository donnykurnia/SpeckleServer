{"remainingRequest":"/Users/donnykurnia/data/Projects/upwork/3dbyggeri/glasshouse/SpeckleServer/plugins/admin/node_modules/thread-loader/dist/cjs.js!/Users/donnykurnia/data/Projects/upwork/3dbyggeri/glasshouse/SpeckleServer/plugins/admin/node_modules/babel-loader/lib/index.js!/Users/donnykurnia/data/Projects/upwork/3dbyggeri/glasshouse/SpeckleServer/plugins/admin/src/store/store.js","dependencies":[{"path":"/Users/donnykurnia/data/Projects/upwork/3dbyggeri/glasshouse/SpeckleServer/plugins/admin/src/store/store.js","mtime":1609071089428},{"path":"/Users/donnykurnia/data/Projects/upwork/3dbyggeri/glasshouse/SpeckleServer/plugins/admin/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/donnykurnia/data/Projects/upwork/3dbyggeri/glasshouse/SpeckleServer/plugins/admin/node_modules/thread-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/donnykurnia/data/Projects/upwork/3dbyggeri/glasshouse/SpeckleServer/plugins/admin/node_modules/babel-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["import \"regenerator-runtime/runtime\";\nimport _asyncToGenerator from \"/Users/donnykurnia/data/Projects/upwork/3dbyggeri/glasshouse/SpeckleServer/plugins/admin/node_modules/@babel/runtime-corejs2/helpers/esm/asyncToGenerator\";\nimport _JSON$stringify from \"/Users/donnykurnia/data/Projects/upwork/3dbyggeri/glasshouse/SpeckleServer/plugins/admin/node_modules/@babel/runtime-corejs2/core-js/json/stringify\";\nimport \"core-js/modules/es6.string.iterator\";\nimport _Promise from \"/Users/donnykurnia/data/Projects/upwork/3dbyggeri/glasshouse/SpeckleServer/plugins/admin/node_modules/@babel/runtime-corejs2/core-js/promise\";\nimport _Object$keys from \"/Users/donnykurnia/data/Projects/upwork/3dbyggeri/glasshouse/SpeckleServer/plugins/admin/node_modules/@babel/runtime-corejs2/core-js/object/keys\";\nimport \"core-js/modules/es6.array.find\";\nimport \"core-js/modules/es6.array.find-index\";\nimport _getIterator from \"/Users/donnykurnia/data/Projects/upwork/3dbyggeri/glasshouse/SpeckleServer/plugins/admin/node_modules/@babel/runtime-corejs2/core-js/get-iterator\";\nimport _toConsumableArray from \"/Users/donnykurnia/data/Projects/upwork/3dbyggeri/glasshouse/SpeckleServer/plugins/admin/node_modules/@babel/runtime-corejs2/helpers/esm/toConsumableArray\";\nimport \"core-js/modules/es6.array.sort\";\nimport _Set from \"/Users/donnykurnia/data/Projects/upwork/3dbyggeri/glasshouse/SpeckleServer/plugins/admin/node_modules/@babel/runtime-corejs2/core-js/set\";\nimport \"core-js/modules/es7.array.includes\";\nimport \"core-js/modules/es6.string.includes\";\nimport \"core-js/modules/es6.regexp.split\";\nimport \"core-js/modules/es6.regexp.to-string\";\nimport \"core-js/modules/es6.function.name\";\nimport \"core-js/modules/web.dom.iterable\";\nimport Vue from 'vue';\nimport Vuex from 'vuex';\nimport Axios from 'axios';\nimport * as Msal from 'msal';\nimport uniq from 'lodash.uniq';\nimport uuid from 'uuid/v4';\nimport flatten from 'flat';\nimport { LambdaSettings } from './lambda/_lambdaSettings.js';\nimport { removeArraysRecursive, getStructuralArrPropKeys, getTokenMSAL } from './utilities.js';\nVue.use(Vuex); // import store modules\n\nimport admin from './admin.js';\nimport viewer from './viewer.js'; // main store module\n\nexport default new Vuex.Store({\n  state: {\n    appVersion: '1.0.3',\n    // The canonical and correct server url, i.e. `https://speckle.server.com/api`\n    server: null,\n    // The server description\n    serverManifest: null,\n    token: null,\n    user: {},\n    isAuth: false,\n    // where all the streams and their properties are stored.\n    streams: [],\n    // data editable streams; we store objects and layers in here. rest of metadata\n    // is in streams proper array (see above).\n    deStreams: [],\n    // global store for stream clients.\n    clients: [],\n    // global store for projects\n    projects: [],\n    comments: [],\n    // global store for users. it's dynamically assembled as the end-user moves through\n    // the admin ui, and new user profiles need to be requested.\n    users: [],\n    // viewer/processor related\n    loadedStreamIds: [],\n    objects: [],\n    legend: null,\n    selectedObjects: [],\n    // client (used for ws requests, etc.)\n    myClient: null,\n    // app dark mode?\n    dark: false,\n    // toggles viewer controls\n    viewerControls: false,\n    // a list of plugins registered with the server\n    plugins: [],\n    // a list of plugins registered with the app\n    adminPlugins: [],\n    // processor related\n    // these are the function names for each block from /src/lambda\n    // if you want to add your own lambda, add the function/file name to the list to expose it\n    lambdas: [],\n    processors: [],\n    tokens: {}\n  },\n  getters: {\n    streamClients: function streamClients(state) {\n      return function (streamId) {\n        return state.clients.filter(function (c) {\n          return c.streamId === streamId;\n        });\n      };\n    },\n    filteredResources: function filteredResources(state) {\n      return function (filters, resourceType) {\n        if (!resourceType) resourceType = \"streams\";\n        var base = [];\n        if (resourceType === \"streams\") base = state.streams.filter(function (stream) {\n          return stream.parent == null && stream.deleted === false;\n        });\n        if (resourceType === \"projects\") base = state.projects.filter(function (project) {\n          return project.deleted === false;\n        });\n        if (!filters || filters.length === 0) return base;\n        filters.forEach(function (query) {\n          query.key = query.key.toLowerCase();\n          if (query.value === null) base = base;else {\n            base = base.filter(function (stream) {\n              return stream.name !== '';\n            });\n\n            switch (query.key) {\n              case 'private':\n                if (query.value) base = base.filter(function (stream) {\n                  return stream.private.toString() === query.value;\n                });else base = base.filter(function (stream) {\n                  return stream.private === true;\n                });\n                break;\n\n              case 'public':\n                if (query.value) base = base.filter(function (stream) {\n                  return (!stream.private).toString() === query.value;\n                });else base = base.filter(function (stream) {\n                  return stream.private === false;\n                });\n                break;\n\n              case 'tag':\n              case 'tags':\n                var myTags = query.value.trim().split(',').map(function (t) {\n                  return t.toLowerCase().trim();\n                });\n                console.log(myTags);\n                base = base.filter(function (stream) {\n                  var streamTags = stream.tags.map(function (t) {\n                    return t.toLowerCase();\n                  });\n                  return myTags.every(function (t) {\n                    return streamTags.includes(t);\n                  });\n                });\n                break;\n\n              case 'jn':\n                base = base.filter(function (resource) {\n                  return resource.jobNumber === query.value.trim();\n                });\n                break;\n\n              case 'owner':\n                if (query.value.toLowerCase().trim() === 'me') {\n                  base = base.filter(function (stream) {\n                    return stream.owner === state.user._id;\n                  });\n                }\n\n                break;\n\n              case 'mine':\n                base = base.filter(function (stream) {\n                  return stream.owner === state.user._id;\n                });\n                break;\n\n              case 'shared':\n                base = base.filter(function (stream) {\n                  return stream.owner !== state.user._id;\n                });\n                break;\n\n              case 'name':\n                base = base.filter(function (stream) {\n                  return stream.name ? stream.name.toLowerCase().includes(query.value.toLowerCase()) : true;\n                });\n                break;\n\n              case 'streamid':\n              case 'id':\n                base = base.filter(function (stream) {\n                  return stream.streamId.toLowerCase().includes(query.value.toLowerCase());\n                });\n                break;\n            }\n          }\n        });\n        return base;\n      };\n    },\n    objectPropertyKeys: function objectPropertyKeys(state) {\n      var keySet = new _Set();\n      var stringKeySet = new _Set();\n      state.objects.forEach(function (obj) {\n        if (!obj.properties) return;\n        var flatProps = flatten(removeArraysRecursive(obj.properties));\n\n        for (var key in flatProps) {\n          if (key === 'hash' || key === 'id' || key.toLowerCase().includes('hash') || key.toLowerCase().includes('_carbon')) continue;\n          if (key.includes('__')) continue;\n          keySet.add(key);\n          if (typeof flatProps[key] === 'string') stringKeySet.add(key);\n        }\n      });\n      var keySets = {\n        allKeys: _toConsumableArray(keySet).sort(function (a, b) {\n          return a.split('.').length - b.split('.').length;\n        }).sort(function (a, b) {\n          return a.length - b.length;\n        }),\n        stringKeys: _toConsumableArray(stringKeySet).sort(function (a, b) {\n          return a.split('.').length - b.split('.').length;\n        }).sort(function (a, b) {\n          return a.length - b.length;\n        })\n      };\n      return keySets;\n    },\n    // NOTE: this assumes results from GSA\n    hasStructuralProperties: function hasStructuralProperties(state) {\n      var _iteratorNormalCompletion = true;\n      var _didIteratorError = false;\n      var _iteratorError = undefined;\n\n      try {\n        for (var _iterator = _getIterator(state.objects), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {\n          var obj = _step.value;\n\n          try {\n            if (obj.properties.structural.result !== null) return true;\n          } catch (_unused) {}\n        }\n      } catch (err) {\n        _didIteratorError = true;\n        _iteratorError = err;\n      } finally {\n        try {\n          if (!_iteratorNormalCompletion && _iterator.return != null) {\n            _iterator.return();\n          }\n        } finally {\n          if (_didIteratorError) {\n            throw _iteratorError;\n          }\n        }\n      }\n\n      return false;\n    },\n    // NOTE: this assumes results from GSA\n    structuralKeys: function structuralKeys(state) {\n      var keys = new _Set();\n      var _iteratorNormalCompletion2 = true;\n      var _didIteratorError2 = false;\n      var _iteratorError2 = undefined;\n\n      try {\n        for (var _iterator2 = _getIterator(state.objects), _step2; !(_iteratorNormalCompletion2 = (_step2 = _iterator2.next()).done); _iteratorNormalCompletion2 = true) {\n          var obj = _step2.value;\n\n          try {\n            var props = flatten(getStructuralArrPropKeys(obj.properties.structural.result));\n\n            for (var key in props) {\n              keys.add(key);\n            }\n          } catch (_unused2) {}\n        }\n      } catch (err) {\n        _didIteratorError2 = true;\n        _iteratorError2 = err;\n      } finally {\n        try {\n          if (!_iteratorNormalCompletion2 && _iterator2.return != null) {\n            _iterator2.return();\n          }\n        } finally {\n          if (_didIteratorError2) {\n            throw _iteratorError2;\n          }\n        }\n      }\n\n      return _toConsumableArray(keys);\n    },\n    allTags: function allTags(state) {\n      var tagSet = new _Set();\n      state.streams.forEach(function (stream) {\n        if (!stream.deleted) stream.tags.forEach(function (t) {\n          return tagSet.add(t);\n        });\n      });\n      state.projects.forEach(function (project) {\n        project.tags.forEach(function (t) {\n          return tagSet.add(t);\n        });\n      });\n      return _toConsumableArray(tagSet);\n    },\n    allStreamTags: function allStreamTags(state) {\n      var tagSet = new _Set();\n      state.streams.forEach(function (stream) {\n        if (!stream.deleted) stream.tags.forEach(function (t) {\n          return tagSet.add(t);\n        });\n      });\n      return _toConsumableArray(tagSet);\n    },\n    allProjectTags: function allProjectTags(state) {\n      var tagSet = new _Set();\n      state.projects.forEach(function (project) {\n        project.tags.forEach(function (t) {\n          return tagSet.add(t);\n        });\n      });\n      return _toConsumableArray(tagSet);\n    },\n    allJobNumbers: function allJobNumbers(state) {\n      var set = new _Set();\n      state.streams.forEach(function (stream) {\n        return set.add(stream.jobNumber);\n      });\n      state.projects.forEach(function (project) {\n        return set.add(project.jobNumber);\n      });\n      return _toConsumableArray(set);\n    },\n    allJobNumbersStreams: function allJobNumbersStreams(state) {\n      var set = new _Set();\n      state.streams.forEach(function (stream) {\n        return set.add(stream.jobNumber);\n      }); // state.projects.forEach( project => set.add( project.jobNumber ) )\n\n      return _toConsumableArray(set);\n    },\n    allJobNumbersProjects: function allJobNumbersProjects(state) {\n      var set = new _Set(); // state.streams.forEach( stream => set.add( stream.jobNumber ) )\n\n      state.projects.forEach(function (project) {\n        return set.add(project.jobNumber);\n      });\n      return _toConsumableArray(set);\n    }\n  },\n  mutations: {\n    SET_DARK: function SET_DARK(state, dark) {\n      state.dark = dark;\n    },\n    TOGGLE_VIEWER_CONTROLS: function TOGGLE_VIEWER_CONTROLS(state) {\n      state.viewerControls = !state.viewerControls;\n    },\n    SET_VIEWER_CONTROLS: function SET_VIEWER_CONTROLS(state, value) {\n      state.viewerControls = value;\n    },\n    // Streams\n    ADD_STREAMS: function ADD_STREAMS(state, streams) {\n      streams.forEach(function (stream) {\n        if (state.streams.findIndex(function (x) {\n          return x.streamId === stream.streamId;\n        }) === -1) {\n          if (!stream.description) stream.description = '...';\n          if (!stream.tags) stream.tags = [];\n          if (!stream.jobNumber) stream.jobNumber = '';\n          state.streams.unshift(stream);\n        }\n      });\n    },\n    UPDATE_STREAM: function UPDATE_STREAM(state, props) {\n      var found = state.streams.find(function (s) {\n        return s.streamId === props.streamId;\n      });\n      if (!found) return console.error('stream not found; aborting update.');\n\n      _Object$keys(props).forEach(function (key) {\n        found[key] = props[key];\n      });\n\n      found.updatedAt = new Date().toISOString();\n    },\n    UPDATE_STREAM_DATA: function UPDATE_STREAM_DATA(state, props) {\n      var found = state.streams.find(function (s) {\n        return s.streamId === props.streamId;\n      });\n      if (props.layers) found.layers = props.layers;\n      found.updatedAt = new Date().toISOString(); // console.log('TODO')\n    },\n    DELETE_STREAM: function DELETE_STREAM(state, stream) {\n      var index = state.streams.findIndex(function (s) {\n        return s.streamId === stream.streamId;\n      });\n\n      if (index > -1) {\n        state.streams.splice(index, 1);\n      } else console.log(\"Failed to remove stream \".concat(stream.streamId, \" from store.\"));\n    },\n    // Clients\n    ADD_CLIENTS: function ADD_CLIENTS(state, clients) {\n      clients.forEach(function (client) {\n        if (state.clients.findIndex(function (x) {\n          return x._id === client._id;\n        }) === -1) {\n          state.clients.push(client);\n        }\n      });\n    },\n    ADD_DE_STREAM: function ADD_DE_STREAM(state, stream) {\n      var found = state.deStreams.find(function (s) {\n        return s.streamId === stream;\n      });\n      if (!found) state.deStreams.push(stream);else {\n        found.layers = stream.layers;\n        found.objects = stream.objects;\n      }\n    },\n    ADD_DE_STREAM_LAYER: function ADD_DE_STREAM_LAYER(state, stream) {\n      console.log(stream);\n      var found = state.deStreams.find(function (s) {\n        return s.streamId === stream.streamId;\n      });\n      var newLayer = {\n        name: \"Param group \".concat(found.layers.length + 1),\n        orderIndex: found.layers.length,\n        startIndex: found.objects.length,\n        objectCount: 0,\n        topology: \"0-0\",\n        guid: uuid()\n      };\n      found.layers.push(newLayer);\n    },\n    UPDATE_DE_STREAM_LAYER: function UPDATE_DE_STREAM_LAYER(state, _ref) {\n      var streamId = _ref.streamId,\n          layer = _ref.layer,\n          objects = _ref.objects;\n      var found = state.deStreams.find(function (s) {\n        return s.streamId === streamId;\n      });\n      var surpassed = false,\n          objectCountDifference = 0;\n      found.layers.forEach(function (iterLayer) {\n        if (surpassed) {\n          iterLayer.startIndex += objectCountDifference;\n        } else if (iterLayer.guid === layer.guid) {\n          var _found$objects;\n\n          iterLayer.name = layer.name;\n          iterLayer.topology = \"0-\".concat(objects.length);\n          objectCountDifference = objects.length - iterLayer.objectCount;\n\n          (_found$objects = found.objects).splice.apply(_found$objects, [iterLayer.startIndex, iterLayer.objectCount].concat(_toConsumableArray(objects)));\n\n          iterLayer.objectCount = objects.length;\n          surpassed = true;\n        }\n      });\n    },\n    REMOVE_DE_STREAM_LAYER: function REMOVE_DE_STREAM_LAYER(state, _ref2) {\n      var streamId = _ref2.streamId,\n          layer = _ref2.layer;\n      var found = state.deStreams.find(function (s) {\n        return s.streamId === streamId;\n      }); // dump objects\n\n      found.objects.splice(layer.startIndex, layer.objectCount); // adjust start indexes\n\n      var surpassed = false;\n      found.layers.forEach(function (iterLayer) {\n        if (surpassed) {\n          iterLayer.startIndex -= layer.objectCount;\n          iterLayer.orderIndex -= 1;\n        } else if (iterLayer.guid === layer.guid) surpassed = true;\n      }); // dump layer\n\n      found.layers = found.layers.filter(function (l) {\n        return l.guid !== layer.guid;\n      });\n    },\n    APPEND_DE_STREAM_LAYERS_FROM_CSV: function APPEND_DE_STREAM_LAYERS_FROM_CSV(state, _ref3) {\n      var streamId = _ref3.streamId,\n          transposed = _ref3.transposed;\n      var found = state.deStreams.find(function (s) {\n        return s.streamId === streamId;\n      });\n      var index = 0;\n      var _iteratorNormalCompletion3 = true;\n      var _didIteratorError3 = false;\n      var _iteratorError3 = undefined;\n\n      try {\n        for (var _iterator3 = _getIterator(transposed), _step3; !(_iteratorNormalCompletion3 = (_step3 = _iterator3.next()).done); _iteratorNormalCompletion3 = true) {\n          var _found$objects2;\n\n          var arr = _step3.value;\n          var newLayer = {\n            name: arr[0] !== '' ? arr[0] : \"Unnamed\",\n            orderIndex: -1,\n            // to be set properly afterwards\n            startIndex: index === 0 ? found.objects.length : found.objects.length,\n            objectCount: arr.length - 1,\n            topology: \"0-\".concat(arr.length - 1),\n            guid: uuid()\n          };\n          found.layers.push(newLayer);\n          var noHeader = arr.slice(1, arr.length);\n          console.log(noHeader);\n\n          (_found$objects2 = found.objects).push.apply(_found$objects2, _toConsumableArray(noHeader.map(function (val) {\n            if (!val) return {\n              type: \"Null\",\n              value: \"\"\n            };\n            if (typeof val === 'boolean') return {\n              type: \"Boolean\",\n              value: val\n            };\n            if (typeof val === 'number') return {\n              type: \"Number\",\n              value: val // TODO: Hash it please\n\n            };\n            if (typeof val === 'string') return {\n              type: \"String\",\n              value: val // TODO: Hash it please\n\n            };\n          })));\n\n          index++;\n        }\n      } catch (err) {\n        _didIteratorError3 = true;\n        _iteratorError3 = err;\n      } finally {\n        try {\n          if (!_iteratorNormalCompletion3 && _iterator3.return != null) {\n            _iterator3.return();\n          }\n        } finally {\n          if (_didIteratorError3) {\n            throw _iteratorError3;\n          }\n        }\n      }\n\n      found.layers.forEach(function (layer, k) {\n        console.log(k);\n        layer.orderIndex = k;\n      });\n    },\n    // Projects\n    ADD_PROJECTS: function ADD_PROJECTS(state, projects) {\n      projects.forEach(function (project) {\n        if (state.projects.findIndex(function (p) {\n          return p._id === project._id;\n        }) === -1) {\n          // potentially enforce here extra fields\n          if (!project.tags) project.tags = [];\n          if (!project.deleted) project.deleted = false;\n          if (!project.jobNumber) project.jobNumber = '';\n          state.projects.unshift(project);\n        }\n      });\n    },\n    UPDATE_PROJECT: function UPDATE_PROJECT(state, props) {\n      var found = state.projects.find(function (p) {\n        return p._id === props._id;\n      });\n      if (found == null) return console.warn('The admin user is not on this project');\n\n      _Object$keys(props).forEach(function (key) {\n        found[key] = props[key];\n      });\n\n      found.updatedAt = new Date().toISOString();\n    },\n    DELETE_PROJECT: function DELETE_PROJECT(state, props) {\n      var index = state.projects.findIndex(function (p) {\n        return p._id === props._id;\n      });\n\n      if (index > -1) {\n        state.projects.splice(index, 1);\n      } else console.log(\"Failed to remove project \".concat(props._id, \" from store.\"));\n    },\n    // Processors\n    ADD_LAMBDAS: function ADD_LAMBDAS(state, lambdas) {\n      lambdas.forEach(function (lambda) {\n        if (state.lambdas.findIndex(function (p) {\n          return p.function === lambda.function;\n        }) === -1) {\n          state.lambdas.push(lambda);\n        }\n      });\n    },\n    ADD_PROCESSORS: function ADD_PROCESSORS(state, processors) {\n      processors.forEach(function (processor) {\n        if (state.processors.findIndex(function (p) {\n          return p._id === processor._id;\n        }) === -1) {\n          // potentially enforce here extra fields\n          if (!processor.tags) processor.tags = [];\n          state.processors.unshift(processor);\n        }\n      });\n    },\n    UPDATE_PROCESSOR: function UPDATE_PROCESSOR(state, props) {\n      var found = state.processors.find(function (p) {\n        return p._id == props._id;\n      });\n\n      _Object$keys(props).forEach(function (key) {\n        found[key] = props[key];\n      });\n    },\n    DELETE_PROCESSOR: function DELETE_PROCESSOR(state, props) {\n      var index = state.processors.findIndex(function (p) {\n        return p._id === props._id;\n      });\n\n      if (index > -1) {\n        state.processors.splice(index, 1);\n      } else console.log(\"Failed to remove processor \".concat(props._id, \" from store.\"));\n    },\n    ADD_TOKEN: function ADD_TOKEN(state, _ref4) {\n      var id = _ref4.id,\n          token = _ref4.token;\n      Vue.set(state.tokens, id, token);\n      console.log(state.tokens);\n    },\n    DELETE_TOKEN: function DELETE_TOKEN(state, id) {\n      Vue.delete(state.tokens, id);\n      console.log(state.tokens);\n    },\n    // Users\n    ADD_USER: function ADD_USER(state, user) {\n      var found = state.users.find(function (u) {\n        return u._id === user._id;\n      });\n      if (!found) state.users.unshift(user);else found = user; // update the user\n    },\n    ADD_USERS: function ADD_USERS(state, users) {\n      users.forEach(function (user) {\n        var found = state.users.find(function (u) {\n          return u._id === user._id;\n        });\n        if (!found) state.users.unshift(user);else found = user; // update the user\n      });\n    },\n    UPDATE_USER: function UPDATE_USER(state, user) {\n      var found = null;\n      if (user._id === state.user._id) found = state.user;else found = state.users.find(function (u) {\n        return u._id === user._id;\n      });\n      if (!found) return console.error('User not found; aborting update.');\n\n      _Object$keys(user).forEach(function (key) {\n        found[key] = user[key];\n      });\n    },\n    // Generics\n    SET_SERVER: function SET_SERVER(state, server) {\n      state.server = server;\n    },\n    SET_SERVER_DETAILS: function SET_SERVER_DETAILS(state, serverManifest) {\n      state.serverManifest = serverManifest;\n    },\n    SET_TOKEN: function SET_TOKEN(state, token) {\n      state.token = token;\n      state.isAuth = true;\n    },\n    SET_USER: function SET_USER(state, user) {\n      state.user = user;\n    },\n    SET_WEB_APP_CLIENT: function SET_WEB_APP_CLIENT(state, client) {\n      state.client = client;\n    },\n    // End of life\n    FLUSH_ALL: function FLUSH_ALL(state) {\n      state.token = null;\n      state.user = {};\n      state.streams = [];\n      state.projects = [];\n      state.clients = [];\n      state.users = [];\n      state.comments = [];\n      state.isAuth = false;\n      state.server = null;\n    },\n    // Viewer related\n    ADD_LOADED_STREAMID: function ADD_LOADED_STREAMID(state, streamId) {\n      state.loadedStreamIds = _toConsumableArray(new _Set([].concat(_toConsumableArray(state.loadedStreamIds), [streamId])));\n    },\n    REMOVE_LOADED_STREAMID: function REMOVE_LOADED_STREAMID(state, streamId) {\n      var index = state.loadedStreamIds.indexOf(streamId);\n      if (index !== -1) state.loadedStreamIds.splice(index, 1);else console.warn(\"Failed to remove loaded streamid: \".concat(streamId, \" from \").concat(state.loadedStreamIds));\n    },\n    // OBJECTS\n    ADD_OBJECTS: function ADD_OBJECTS(state, objects) {\n      var _state$objects;\n\n      (_state$objects = state.objects).push.apply(_state$objects, _toConsumableArray(objects));\n    },\n    UPDATE_OBJECTS_STREAMS: function UPDATE_OBJECTS_STREAMS(state, _ref5) {\n      var objIds = _ref5.objIds,\n          streamToAdd = _ref5.streamToAdd,\n          streamToRemove = _ref5.streamToRemove;\n      objIds.forEach(function (id) {\n        var myObject = state.objects.find(function (o) {\n          return o._id === id;\n        });\n\n        if (myObject) {\n          if (streamToAdd && myObject.streams.indexOf(streamToAdd) === -1) myObject.streams.push(streamToAdd);\n\n          if (streamToRemove) {\n            var index = myObject.streams.indexOf(streamToRemove);\n            if (index !== -1) myObject.streams.splice(index, 1);\n          }\n        }\n      });\n    },\n    REMOVE_OBJECTS: function REMOVE_OBJECTS(state, objectIds) {\n      state.objects = state.objects.filter(function (obj) {\n        return objectIds.indexOf(obj._id) === -1;\n      });\n    },\n    // Selected objects setters\n    SET_SELECTED_OBJECTS: function SET_SELECTED_OBJECTS(state, _ref6) {\n      var objectIds = _ref6.objectIds;\n      if (objectIds.length > 0) state.selectedObjects = _toConsumableArray(new _Set([].concat(_toConsumableArray(state.selectedObjects), _toConsumableArray(objectIds))));else state.selectedObjects = [];\n    },\n    ADD_SELECTED_OBJECTS: function ADD_SELECTED_OBJECTS(state, _ref7) {\n      var objectIds = _ref7.objectIds;\n      state.selectedObjects = _toConsumableArray(new _Set([].concat(_toConsumableArray(state.selectedObjects), _toConsumableArray(objectIds))));\n    },\n    REMOVE_SELECTED_OBJECTS: function REMOVE_SELECTED_OBJECTS(state, _ref8) {\n      var objectIds = _ref8.objectIds;\n      objectIds.forEach(function (id) {\n        var index = state.selectedObjects.indexOf(id);\n        if (index !== -1) state.selectedObjects.splice(index, 1);\n      });\n    },\n    SET_LEGEND: function SET_LEGEND(state, legend) {\n      state.legend = legend;\n    },\n    ADD_PLUGIN: function ADD_PLUGIN(state, plugin) {\n      state.plugins.push(plugin);\n    }\n  },\n  actions: {\n    // Streams\n    getStream: function getStream(context, props) {\n      return new _Promise(function (resolve, reject) {\n        var found = context.state.streams.find(function (s) {\n          return s.streamId === props.streamId;\n        });\n        if (found) return resolve(found);\n        Axios.get(\"streams/\".concat(props.streamId, \"?omit=objects\")).then(function (res) {\n          context.commit('ADD_STREAMS', [res.data.resource]);\n          return resolve(res);\n        }).catch(function (err) {\n          return reject(err);\n        });\n      });\n    },\n    refreshStream: function refreshStream(context, props) {\n      return new _Promise(function (resolve, reject) {\n        Axios.get(\"streams/\".concat(props.streamId, \"?omit=objects\")).then(function (res) {\n          context.commit('UPDATE_STREAM', res.data.resource);\n          return resolve(res);\n        }).catch(function (err) {\n          return reject(err);\n        });\n      });\n    },\n    getStreams: function getStreams(context, query) {\n      return new _Promise(function (resolve, reject) {\n        Axios.get(\"streams?\".concat(query ? query : '')).then(function (res) {\n          context.commit('ADD_STREAMS', res.data.resources);\n          return resolve(res.data.resources);\n        }).catch(function (err) {\n          console.log(err);\n          return reject(err);\n        });\n      });\n    },\n    createStream: function createStream(context, stream) {\n      var streamId = null;\n      return new _Promise(function (resolve, reject) {\n        Axios.post(\"streams\").then(function (res) {\n          console.log(res);\n          stream.streamId = res.data.resource.streamId;\n          res.data.resource.onlineEditable = true;\n          context.commit('ADD_STREAMS', [res.data.resource]); //namespacing the admin module caused other issues, so we'll call this here as well\n\n          context.commit('ADD_STREAMS_ADMIN', [res.data.resource]);\n          return Axios.put(\"streams/\".concat(res.data.resource.streamId), stream);\n        }).then(function (res) {\n          console.log(res);\n          context.commit('UPDATE_STREAM', stream);\n          return resolve(stream);\n        }).catch(function (err) {\n          console.error(err);\n          return reject(err);\n        });\n      });\n    },\n    updateStream: function updateStream(context, props) {\n      Axios.put(\"streams/\".concat(props.streamId), props).then(function (res) {\n        // modules.admin\n        context.commit('UPDATE_STREAM', props);\n      }).catch(function (err) {\n        console.warn(err);\n      });\n    },\n    // For data-editable streams only\n    updateStreamObjectsAndLayers: function updateStreamObjectsAndLayers(context, _ref9) {\n      var streamId = _ref9.streamId,\n          commitMessage = _ref9.commitMessage;\n      return new _Promise(function (resolve, reject) {\n        var found = context.state.deStreams.find(function (s) {\n          return s.streamId === streamId;\n        });\n        if (!found) return reject(new Error('Stream not found in store.'));\n        found.commitMessage = commitMessage + \" (changed by \".concat(context.state.user.name, \" \").concat(context.state.user.surname, \")\");\n        found.lastChangedBy = context.state.user._id;\n        context.commit('UPDATE_STREAM', {\n          streamId: streamId,\n          commitMessage: commitMessage\n        });\n        Axios.post(\"streams/\".concat(streamId, \"/clone\")).then(function (res) {\n          var originalStream = context.state.streams.find(function (s) {\n            return s.streamId === streamId;\n          });\n          context.commit('UPDATE_STREAM', {\n            streamId: streamId,\n            children: [].concat(_toConsumableArray(originalStream.children), [res.data.clone.streamId])\n          });\n          return Axios.put(\"streams/\".concat(streamId), found);\n        }).then(function (res) {\n          return resolve(res);\n        }).catch(function (err) {\n          return reject(err);\n        });\n      });\n    },\n    getStreamClients: function getStreamClients(context, props) {\n      Axios.get(\"streams/\".concat(props.streamId, \"/clients\")).then(function (res) {\n        context.commit('ADD_CLIENTS', res.data.resources);\n      }).catch(function (err) {\n        console.log(err);\n      });\n    },\n    deleteStream: function deleteStream(context, payload) {\n      // TODO: https://github.com/speckleworks/SpeckleAdmin/issues/19\n      Axios.delete(\"streams/\".concat(payload.streamId)).then(function (res) {\n        context.commit('DELETE_STREAM', {\n          streamId: payload.streamId\n        });\n      }).catch(function (err) {\n        console.log(err);\n      });\n    },\n    // objects\n    getStreamObjects: function getStreamObjects(context, streamId) {\n      var found = context.state.streams.find(function (s) {\n        return s.streamId === streamId;\n      });\n      return new _Promise(function (resolve, reject) {\n        context.dispatch('getStream', {\n          streamId: streamId\n        }).then(function () {\n          return Axios.get(\"streams/\".concat(streamId, \"?fields=objects,layers\"));\n        }).then(function (res) {\n          var ids = res.data.resource.objects.map(function (o) {\n            return o._id;\n          });\n          context.commit('UPDATE_STREAM', {\n            streamId: streamId,\n            objects: ids,\n            layers: res.data.resource.layers\n          });\n          resolve(ids);\n        }).catch(function (err) {\n          reject(err);\n        });\n      });\n    },\n    getObjects: function getObjects(context, objectIds) {\n      return new _Promise(function (resolve, reject) {\n        Axios.post(\"objects/getbulk?omit=base64,rawData,canRead,canWrite,children,anonymousComments,name\", objectIds).then(function (res) {\n          // context.state.objects.push( ...res.data.resources )\n          // context.commit( 'ADD_OBJECTS', res.data.resources )\n          resolve(res.data.resources);\n        }).catch(function (err) {\n          return reject(err);\n        });\n      });\n    },\n    createObjects: function createObjects(context, objects) {\n      return new _Promise(function (resolve, reject) {\n        Axios.post(\"objects\", objects).then(function (res) {\n          return resolve(res.data.resources);\n        }).catch(function (err) {\n          return reject(err);\n        });\n      });\n    },\n    // projects\n    getProject: function getProject(context, props) {\n      return new _Promise(function (resolve, reject) {\n        Axios.get(\"projects/\".concat(props._id)).then(function (res) {\n          context.commit('ADD_PROJECTS', [res.data.resource]);\n          return resolve(res);\n        }).catch(function (err) {\n          console.error(err);\n          return reject(err);\n        });\n      });\n    },\n    getProjects: function getProjects(context, query) {\n      return new _Promise(function (resolve, reject) {\n        Axios.get(\"projects?\".concat(query ? query : '')).then(function (res) {\n          context.commit('ADD_PROJECTS', res.data.resources);\n          return resolve(res.data.resources);\n        }).catch(function (err) {\n          console.log(err);\n          return reject(err);\n        });\n      });\n    },\n    createProject: function createProject(context, project) {\n      return new _Promise(function (resolve, reject) {\n        Axios.post(\"projects\", project ? project : {\n          name: 'A new speckle project'\n        }).then(function (res) {\n          context.commit('ADD_PROJECTS', [res.data.resource]); //namespacing the admin module caused other issues, so we'll call this here as well\n\n          context.commit('ADD_PROJECTS_ADMIN', [res.data.resource]);\n          return resolve(res.data.resource);\n        }).catch(function (err) {\n          console.log(err);\n          return reject(err);\n        });\n      });\n    },\n    updateProject: function updateProject(context, props) {\n      Axios.put(\"projects/\".concat(props._id), props).then(function (res) {\n        context.commit('UPDATE_PROJECT', props);\n      }).catch(function (err) {\n        console.warn(err);\n      });\n    },\n    addUserToProject: function addUserToProject(context, _ref10) {\n      var projectId = _ref10.projectId,\n          userId = _ref10.userId;\n      return new _Promise(function (resolve, reject) {\n        var project = context.state.projects.find(function (p) {\n          return p._id === projectId;\n        });\n        if (!project) return reject(new Error('Failed to find project in state.'));\n        Axios.put(\"projects/\".concat(projectId, \"/adduser/\").concat(userId)).then(function (res) {\n          var permissions = {\n            canWrite: _toConsumableArray(new _Set([].concat(_toConsumableArray(project.permissions.canWrite), [userId]))),\n            canRead: project.permissions.canRead\n          };\n\n          var canRead = _toConsumableArray(new _Set([].concat(_toConsumableArray(project.canRead), [userId])));\n\n          context.commit('UPDATE_PROJECT', {\n            _id: projectId,\n            permissions: permissions,\n            canRead: canRead\n          });\n          project.streams.forEach(function (streamId) {\n            var myStream = context.state.streams.find(function (s) {\n              return s.streamId === streamId;\n            });\n            context.commit('UPDATE_STREAM', {\n              streamId: streamId,\n              canWrite: uniq([].concat(_toConsumableArray(myStream.canWrite), [userId]))\n            });\n          });\n          return resolve();\n        }).catch(function (err) {\n          console.warn(err);\n          return reject(err);\n        });\n      });\n    },\n    upgradeUserInProject: function upgradeUserInProject(context, _ref11) {\n      var projectId = _ref11.projectId,\n          userId = _ref11.userId;\n      return new _Promise(function (resolve, reject) {\n        var project = context.state.projects.find(function (p) {\n          return p._id === projectId;\n        });\n        if (!project) return reject(new Error('Failed to find project in state.'));\n        Axios.put(\"projects/\".concat(projectId, \"/upgradeuser/\").concat(userId)).then(function (res) {\n          return Axios.get(\"projects/\".concat(projectId, \"?fields=permissions\"));\n        }).then(function (res) {\n          context.commit('UPDATE_PROJECT', {\n            _id: projectId,\n            permissions: {\n              canRead: res.data.resource.permissions.canRead,\n              //[ ...new Set( [ ...project.canRead, userId ] ) ],\n              canWrite: res.data.resource.permissions.canWrite //[ ...new Set( [ ...project.canWrite, userId ] ) ]\n\n            }\n          });\n          project.streams.forEach(function (streamId) {\n            var myStream = context.state.streams.find(function (s) {\n              return s.streamId === streamId;\n            });\n            context.commit('UPDATE_STREAM', {\n              streamId: streamId,\n              canWrite: uniq([].concat(_toConsumableArray(myStream.canWrite), [userId])),\n              canRead: uniq([].concat(_toConsumableArray(myStream.canRead), [userId]))\n            });\n          });\n          return resolve();\n        }).catch(function (err) {\n          console.warn(err);\n          return reject(err);\n        });\n      });\n    },\n    downgradeUserInProject: function downgradeUserInProject(context, _ref12) {\n      var projectId = _ref12.projectId,\n          userId = _ref12.userId;\n      return new _Promise(function (resolve, reject) {\n        var project = context.state.projects.find(function (p) {\n          return p._id === projectId;\n        });\n        if (!project) return reject(new Error('Failed to find project in state.'));\n        Axios.put(\"projects/\".concat(projectId, \"/downgradeuser/\").concat(userId)).then(function (res) {\n          context.commit('UPDATE_PROJECT', {\n            _id: projectId,\n            permissions: res.data.project.permissions\n          });\n          res.data.streamsToAddReadAndPullWrite.forEach(function (streamId) {\n            var myStream = context.state.streams.find(function (s) {\n              return s.streamId === streamId;\n            });\n            context.commit('UPDATE_STREAM', {\n              streamId: streamId,\n              canWrite: myStream.canWrite.filter(function (id) {\n                return id !== userId;\n              }),\n              canRead: uniq([].concat(_toConsumableArray(myStream.canRead), [userId]))\n            });\n          });\n          res.data.streamsToAddToRead.forEach(function (streamId) {\n            var myStream = context.state.streams.find(function (s) {\n              return s.streamId === streamId;\n            });\n            context.commit('UPDATE_STREAM', {\n              streamId: streamId,\n              canRead: uniq([].concat(_toConsumableArray(myStream.canRead), [userId]))\n            });\n          });\n          return resolve();\n        }).catch(function (err) {\n          console.warn(err);\n          return reject(err);\n        });\n      });\n    },\n    removeUserInProject: function removeUserInProject(context, _ref13) {\n      var projectId = _ref13.projectId,\n          userId = _ref13.userId;\n      return new _Promise(function (resolve, reject) {\n        var project = context.state.projects.find(function (p) {\n          return p._id === projectId;\n        });\n        if (!project) return reject(new Error('Failed to find project in state.'));\n        Axios.delete(\"projects/\".concat(projectId, \"/removeuser/\").concat(userId)).then(function (res) {\n          context.commit('UPDATE_PROJECT', {\n            _id: projectId,\n            canRead: res.data.project.canRead,\n            canWrite: res.data.project.canWrite,\n            permissions: res.data.project.permissions\n          });\n          res.data.streamsToPullBothFrom.forEach(function (streamId) {\n            var myStream = context.state.streams.find(function (s) {\n              return s.streamId === streamId;\n            });\n            context.commit('UPDATE_STREAM', {\n              streamId: streamId,\n              canRead: myStream.canRead.filter(function (id) {\n                return id !== userId;\n              }),\n              canWrite: myStream.canWrite.filter(function (id) {\n                return id !== userId;\n              })\n            });\n          });\n          res.data.streamsToPullWriteFrom.forEach(function (streamId) {\n            var myStream = context.state.streams.find(function (s) {\n              return s.streamId === streamId;\n            });\n            context.commit('UPDATE_STREAM', {\n              streamId: streamId,\n              canWrite: myStream.canWrite.filter(function (id) {\n                return id !== userId;\n              })\n            });\n          });\n          res.data.streamsToPullReadFrom.forEach(function (streamId) {\n            var myStream = context.state.streams.find(function (s) {\n              return s.streamId === streamId;\n            });\n            context.commit('UPDATE_STREAM', {\n              streamId: streamId,\n              canRead: myStream.canRead.filter(function (id) {\n                return id !== userId;\n              })\n            });\n          });\n          return resolve();\n        }).catch(function (err) {\n          console.warn(err);\n          return reject(err);\n        });\n      });\n    },\n    addStreamToProject: function addStreamToProject(context, _ref14) {\n      var projectId = _ref14.projectId,\n          streamId = _ref14.streamId;\n      return new _Promise(function (resolve, reject) {\n        var project = context.state.projects.find(function (p) {\n          return p._id === projectId;\n        });\n        if (!project) return reject(new Error('Failed to find project in state.'));\n        Axios.put(\"projects/\".concat(projectId, \"/addstream/\").concat(streamId)).then(function (res) {\n          context.commit('UPDATE_PROJECT', {\n            _id: projectId,\n            streams: res.data.project.streams\n          });\n          context.commit('UPDATE_STREAM', {\n            streamId: streamId,\n            canRead: res.data.stream.canRead,\n            canWrite: res.data.stream.canWrite\n          });\n          return resolve();\n        }).catch(function (err) {\n          console.warn(err);\n          return reject(err);\n        });\n      });\n    },\n    removeStreamFromProject: function removeStreamFromProject(context, _ref15) {\n      var projectId = _ref15.projectId,\n          streamId = _ref15.streamId;\n      return new _Promise(function (resolve, reject) {\n        var project = context.state.projects.find(function (p) {\n          return p._id === projectId;\n        });\n        if (!project) return reject(new Error('Failed to find project in state.'));\n        Axios.delete(\"projects/\".concat(projectId, \"/removestream/\").concat(streamId)).then(function (res) {\n          context.commit('UPDATE_PROJECT', {\n            _id: projectId,\n            streams: res.data.project.streams\n          });\n          context.commit('UPDATE_STREAM', {\n            streamId: streamId,\n            canRead: res.data.stream.canRead,\n            canWrite: res.data.stream.canWrite\n          });\n          return resolve();\n        }).catch(function (err) {\n          console.warn(err);\n          return reject(err);\n        });\n      });\n    },\n    deleteProject: function deleteProject(context, props) {\n      return new _Promise(function (resolve, reject) {\n        Axios.delete(\"projects/\".concat(props._id)).then(function (res) {\n          context.commit('DELETE_PROJECT', {\n            _id: props._id\n          });\n          var _iteratorNormalCompletion4 = true;\n          var _didIteratorError4 = false;\n          var _iteratorError4 = undefined;\n\n          try {\n            for (var _iterator4 = _getIterator(res.data.modifiedStreams), _step4; !(_iteratorNormalCompletion4 = (_step4 = _iterator4.next()).done); _iteratorNormalCompletion4 = true) {\n              var stream = _step4.value;\n              context.commit('UPDATE_STREAM', {\n                streamId: stream.streamId,\n                canRead: stream.canRead,\n                canWrite: stream.canWrite\n              });\n            }\n          } catch (err) {\n            _didIteratorError4 = true;\n            _iteratorError4 = err;\n          } finally {\n            try {\n              if (!_iteratorNormalCompletion4 && _iterator4.return != null) {\n                _iterator4.return();\n              }\n            } finally {\n              if (_didIteratorError4) {\n                throw _iteratorError4;\n              }\n            }\n          }\n\n          return resolve();\n        }).catch(function (err) {\n          console.warn(err);\n          return reject(err);\n        });\n      });\n    },\n    // processors\n    loadLambdas: function loadLambdas(context) {\n      return new _Promise(function (resolve, reject) {\n        var promises = [];\n        var myLambdas = new LambdaSettings().Lambdas;\n\n        var _loop = function _loop(i) {\n          promises.push(Axios({\n            method: 'GET',\n            url: \".netlify/functions/\".concat(myLambdas[i]),\n            baseURL: location.protocol + '//' + location.host\n          }).catch(function (err) {\n            return console.log(\"Failed to load lambda: \".concat(myLambdas[i]));\n          }));\n        };\n\n        for (var i = 0; i < myLambdas.length; i++) {\n          _loop(i);\n        }\n\n        _Promise.all(promises).then(function (res) {\n          var lambdas = [];\n          res.forEach(function (r) {\n            if (r) {\n              var data = r.data;\n              data.function = r.request.responseURL.split('/').slice(-1).pop();\n              lambdas.push(data);\n            }\n          });\n          context.commit('ADD_LAMBDAS', lambdas);\n          return resolve(lambdas);\n        });\n      });\n    },\n    getProcessor: function getProcessor(context, props) {\n      var processor = JSON.parse(window.localStorage.getItem(\"processor_\" + props._id));\n      if (processor !== null) context.commit('ADD_PROCESSORS', [processor]);\n      return processor;\n    },\n    getProcessors: function getProcessors(context) {\n      var processorIds = JSON.parse(window.localStorage.getItem(\"processorIds\"));\n      if (processorIds === null) return null;\n      var processors = [];\n      processorIds.forEach(function (id) {\n        var processor = JSON.parse(window.localStorage.getItem(\"processor_\" + id));\n        if (processor != null) processors.unshift(processor);\n      });\n      context.commit('ADD_PROCESSORS', processors);\n      return processors;\n    },\n    createProcessor: function createProcessor(context, processor) {\n      var id = uuid();\n      var proc = processor ? processor : {\n        name: 'A new speckle processor' // Always assign new ID\n\n      };\n      proc._id = id;\n      if (!proc.hasOwnProperty('description')) proc.description = \"This is a simple speckle processor.\";\n      if (!proc.hasOwnProperty('tags')) proc.tags = [];\n      if (!proc.hasOwnProperty('blocks')) proc.blocks = [];\n      if (!proc.hasOwnProperty('params')) proc.params = []; // Properties added for compatibility with other components\n      // as well as for future storage in server\n\n      proc.owner = context.state.user._id;\n      proc.private = false;\n      proc.canRead = [context.state.user._id];\n      proc.canWrite = [context.state.user._id];\n      proc.anonymousComments = false;\n      proc.comments = [];\n      window.localStorage.setItem(\"processor_\" + id, _JSON$stringify(proc));\n      context.commit('ADD_PROCESSORS', [proc]);\n      var processorIds = JSON.parse(window.localStorage.getItem(\"processorIds\"));\n      if (processorIds === null) processorIds = [];\n      processorIds.unshift(id);\n      window.localStorage.setItem(\"processorIds\", _JSON$stringify(processorIds));\n      return proc;\n    },\n    updateProcessor: function updateProcessor(context, props) {\n      var found = JSON.parse(window.localStorage.getItem(\"processor_\" + props._id));\n\n      _Object$keys(props).forEach(function (key) {\n        found[key] = props[key];\n      });\n\n      window.localStorage.setItem(\"processor_\" + props._id, _JSON$stringify(found));\n      context.commit('UPDATE_PROCESSOR', props);\n    },\n    deleteProcessor: function deleteProcessor(context, props) {\n      window.localStorage.removeItem(\"processor_\" + props._id);\n      context.commit('DELETE_PROCESSOR', props);\n      var processorIds = JSON.parse(window.localStorage.getItem(\"processorIds\"));\n\n      if (processorIds !== null) {\n        var foundIndex = processorIds.indexOf(props._id);\n\n        if (foundIndex !== -1) {\n          processorIds.splice(foundIndex, 1);\n          window.localStorage.setItem(\"processorIds\", _JSON$stringify(processorIds));\n        }\n      }\n    },\n    authenticateBlocks: function () {\n      var _authenticateBlocks = _asyncToGenerator(\n      /*#__PURE__*/\n      regeneratorRuntime.mark(function _callee(context, blocks) {\n        var i, propName, token;\n        return regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                i = 0;\n\n              case 1:\n                if (!(i < blocks.length)) {\n                  _context.next = 11;\n                  break;\n                }\n\n                if (!blocks[i].msal) {\n                  _context.next = 8;\n                  break;\n                }\n\n                propName = 'msal|' + blocks[i].msal.clientId;\n                _context.next = 6;\n                return getTokenMSAL(blocks[i].msal);\n\n              case 6:\n                token = _context.sent;\n                context.commit('ADD_TOKEN', {\n                  id: propName,\n                  token: token\n                });\n\n              case 8:\n                i++;\n                _context.next = 1;\n                break;\n\n              case 11:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee);\n      }));\n\n      function authenticateBlocks(_x, _x2) {\n        return _authenticateBlocks.apply(this, arguments);\n      }\n\n      return authenticateBlocks;\n    }(),\n    // client for ws ids, etc.\n    createClient: function createClient(context, props) {\n      return new _Promise(function (resolve, reject) {\n        // NOTE: This is a stupid hack. To get a temp client, we need to be not auhtorised : /\n        delete Axios.defaults.headers.common['Authorization'];\n        Axios.post(\"clients\", {\n          role: 'online-client',\n          documentName: 'Online interface',\n          documentType: 'browser',\n          online: true\n        }).then(function (res) {\n          context.commit('SET_WEB_APP_CLIENT', res.data.resource);\n          return resolve(res.data.resource);\n        }).catch(function (err) {\n          console.warn(err);\n          return reject(err);\n        }); // set the headers back. man what a stupid hack this is...\n\n        Axios.defaults.headers.common['Authorization'] = context.state.token;\n      });\n    },\n    // users\n    getUser: function getUser(context, payload) {\n      return new _Promise(function (resolve, reject) {\n        var found = context.state.users.find(function (u) {\n          return u._id === payload._id;\n        });\n        if (found) return resolve(found);\n        Axios.get(\"accounts/\".concat(payload._id)).then(function (res) {\n          if (context.state.user._id === payload._id) res.data.resource.surname += ' (that is you!)';\n          context.commit('ADD_USER', res.data.resource);\n          return resolve(res.data.resource);\n        }).catch(function (err) {\n          return reject(err);\n        });\n      });\n    },\n    getPlugins: function getPlugins(context, payload) {\n      Axios.get().then(function (res) {\n        var plugins = res.data.plugins;\n        plugins.forEach(function (plugin) {\n          context.commit('ADD_PLUGIN', plugin);\n        });\n      }).catch(function (err) {\n        console.warn(err);\n        return reject(err);\n      });\n    },\n    updateLoggedInUser: function updateLoggedInUser(context, payload) {\n      return new _Promise(function (resolve, reject) {\n        console.log(payload);\n        Axios.put(\"accounts\", payload).then(function (res) {\n          context.commit('UPDATE_USER', payload);\n          return resolve(res);\n        }).catch(function (err) {\n          return reject(err);\n        });\n      });\n    },\n    // Auth\n    authenticate: function authenticate(context, payload) {\n      return new _Promise(\n      /*#__PURE__*/\n      function () {\n        var _ref16 = _asyncToGenerator(\n        /*#__PURE__*/\n        regeneratorRuntime.mark(function _callee2(resolve, reject) {\n          var userProfile, serverDetails, usedServers;\n          return regeneratorRuntime.wrap(function _callee2$(_context2) {\n            while (1) {\n              switch (_context2.prev = _context2.next) {\n                case 0:\n                  _context2.prev = 0;\n                  _context2.next = 3;\n                  return Axios.get(new URL(\"/api/accounts\", payload.server), {\n                    headers: {\n                      'Authorization': payload.token\n                    }\n                  });\n\n                case 3:\n                  userProfile = _context2.sent;\n                  console.log(userProfile);\n                  context.commit('SET_TOKEN', payload.token);\n                  context.commit('SET_USER', userProfile.data.resource);\n                  context.commit('SET_SERVER', new URL(\"/api\", payload.server));\n                  _context2.next = 10;\n                  return Axios.get(\"\".concat(payload.server, \"/api\"));\n\n                case 10:\n                  serverDetails = _context2.sent;\n                  context.commit('SET_SERVER_DETAILS', serverDetails.data);\n                  Axios.defaults.headers.common['Authorization'] = payload.token;\n                  Axios.defaults.baseURL = \"\".concat(payload.server, \"/api\");\n                  localStorage.setItem('currentServer', \"\".concat(payload.server, \"/api\"));\n                  localStorage.setItem('token', payload.token);\n                  usedServers = localStorage.getItem('allSpeckleServers') ? new _Set(localStorage.getItem('allSpeckleServers').split(',')) : new _Set([\"\".concat(payload.server, \"/api\")]); // if( !usedServers ) usedServers = new Set([`${payload.server}/api`])\n\n                  usedServers.add(\"\".concat(payload.server, \"/api\"));\n                  console.log(\"\".concat(payload.server, \"/api\"));\n                  console.log(usedServers);\n                  localStorage.setItem('allSpeckleServers', _toConsumableArray(usedServers));\n                  return _context2.abrupt(\"return\", resolve());\n\n                case 24:\n                  _context2.prev = 24;\n                  _context2.t0 = _context2[\"catch\"](0);\n                  console.log(_context2.t0);\n                  return _context2.abrupt(\"return\", reject(_context2.t0.message));\n\n                case 28:\n                case \"end\":\n                  return _context2.stop();\n              }\n            }\n          }, _callee2, null, [[0, 24]]);\n        }));\n\n        return function (_x3, _x4) {\n          return _ref16.apply(this, arguments);\n        };\n      }());\n    },\n    logout: function logout(context, payload) {\n      context.commit('FLUSH_ALL');\n      localStorage.removeItem('token');\n      localStorage.removeItem('viewerSettings');\n      localStorage.removeItem('currentServer');\n      Axios.defaults.headers.common['Authorization'] = '';\n      Axios.defaults.baseURL = '';\n    }\n  },\n  modules: {\n    admin: admin,\n    viewer: viewer\n  }\n});",{"version":3,"sources":["/Users/donnykurnia/data/Projects/upwork/3dbyggeri/glasshouse/SpeckleServer/plugins/admin/src/store/store.js"],"names":["Vue","Vuex","Axios","Msal","uniq","uuid","flatten","LambdaSettings","removeArraysRecursive","getStructuralArrPropKeys","getTokenMSAL","use","admin","viewer","Store","state","appVersion","server","serverManifest","token","user","isAuth","streams","deStreams","clients","projects","comments","users","loadedStreamIds","objects","legend","selectedObjects","myClient","dark","viewerControls","plugins","adminPlugins","lambdas","processors","tokens","getters","streamClients","streamId","filter","c","filteredResources","filters","resourceType","base","stream","parent","deleted","project","length","forEach","query","key","toLowerCase","value","name","private","toString","myTags","trim","split","map","t","console","log","streamTags","tags","every","includes","resource","jobNumber","owner","_id","objectPropertyKeys","keySet","stringKeySet","obj","properties","flatProps","add","keySets","allKeys","sort","a","b","stringKeys","hasStructuralProperties","structural","result","structuralKeys","keys","props","allTags","tagSet","allStreamTags","allProjectTags","allJobNumbers","set","allJobNumbersStreams","allJobNumbersProjects","mutations","SET_DARK","TOGGLE_VIEWER_CONTROLS","SET_VIEWER_CONTROLS","ADD_STREAMS","findIndex","x","description","unshift","UPDATE_STREAM","found","find","s","error","updatedAt","Date","toISOString","UPDATE_STREAM_DATA","layers","DELETE_STREAM","index","splice","ADD_CLIENTS","client","push","ADD_DE_STREAM","ADD_DE_STREAM_LAYER","newLayer","orderIndex","startIndex","objectCount","topology","guid","UPDATE_DE_STREAM_LAYER","layer","surpassed","objectCountDifference","iterLayer","REMOVE_DE_STREAM_LAYER","l","APPEND_DE_STREAM_LAYERS_FROM_CSV","transposed","arr","noHeader","slice","val","type","k","ADD_PROJECTS","p","UPDATE_PROJECT","warn","DELETE_PROJECT","ADD_LAMBDAS","lambda","function","ADD_PROCESSORS","processor","UPDATE_PROCESSOR","DELETE_PROCESSOR","ADD_TOKEN","id","DELETE_TOKEN","delete","ADD_USER","u","ADD_USERS","UPDATE_USER","SET_SERVER","SET_SERVER_DETAILS","SET_TOKEN","SET_USER","SET_WEB_APP_CLIENT","FLUSH_ALL","ADD_LOADED_STREAMID","REMOVE_LOADED_STREAMID","indexOf","ADD_OBJECTS","UPDATE_OBJECTS_STREAMS","objIds","streamToAdd","streamToRemove","myObject","o","REMOVE_OBJECTS","objectIds","SET_SELECTED_OBJECTS","ADD_SELECTED_OBJECTS","REMOVE_SELECTED_OBJECTS","SET_LEGEND","ADD_PLUGIN","plugin","actions","getStream","context","resolve","reject","get","then","res","commit","data","catch","err","refreshStream","getStreams","resources","createStream","post","onlineEditable","put","updateStream","updateStreamObjectsAndLayers","commitMessage","Error","surname","lastChangedBy","originalStream","children","clone","getStreamClients","deleteStream","payload","getStreamObjects","dispatch","ids","getObjects","createObjects","getProject","getProjects","createProject","updateProject","addUserToProject","projectId","userId","permissions","canWrite","canRead","myStream","upgradeUserInProject","downgradeUserInProject","streamsToAddReadAndPullWrite","streamsToAddToRead","removeUserInProject","streamsToPullBothFrom","streamsToPullWriteFrom","streamsToPullReadFrom","addStreamToProject","removeStreamFromProject","deleteProject","modifiedStreams","loadLambdas","promises","myLambdas","Lambdas","i","method","url","baseURL","location","protocol","host","all","r","request","responseURL","pop","getProcessor","JSON","parse","window","localStorage","getItem","getProcessors","processorIds","createProcessor","proc","hasOwnProperty","blocks","params","anonymousComments","setItem","updateProcessor","deleteProcessor","removeItem","foundIndex","authenticateBlocks","msal","propName","clientId","createClient","defaults","headers","common","role","documentName","documentType","online","getUser","getPlugins","updateLoggedInUser","authenticate","URL","userProfile","serverDetails","usedServers","message","logout","modules"],"mappings":"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","sourcesContent":["import Vue from 'vue'\nimport Vuex from 'vuex'\nimport Axios from 'axios'\nimport * as Msal from 'msal'\n\nimport uniq from 'lodash.uniq'\nimport uuid from 'uuid/v4'\nimport flatten from 'flat'\n\nimport { LambdaSettings } from './lambda/_lambdaSettings.js'\n\nimport { removeArraysRecursive, getStructuralArrPropKeys, getTokenMSAL } from './utilities.js'\n\nVue.use( Vuex )\n\n// import store modules\nimport admin from './admin.js'\nimport viewer from './viewer.js'\n\n// main store module\nexport default new Vuex.Store( {\n  state: {\n    appVersion: '1.0.3',\n    // The canonical and correct server url, i.e. `https://speckle.server.com/api`\n    server: null,\n    // The server description\n    serverManifest: null,\n    token: null,\n    user: {},\n    isAuth: false,\n    // where all the streams and their properties are stored.\n    streams: [ ],\n    // data editable streams; we store objects and layers in here. rest of metadata\n    // is in streams proper array (see above).\n    deStreams: [ ],\n    // global store for stream clients.\n    clients: [ ],\n    // global store for projects\n    projects: [ ],\n    comments: [ ],\n    // global store for users. it's dynamically assembled as the end-user moves through\n    // the admin ui, and new user profiles need to be requested.\n    users: [ ],\n    // viewer/processor related\n    loadedStreamIds: [ ],\n    objects: [ ],\n    legend: null,\n    selectedObjects: [ ],\n    // client (used for ws requests, etc.)\n    myClient: null,\n    // app dark mode?\n    dark: false,\n    // toggles viewer controls\n    viewerControls: false,\n    // a list of plugins registered with the server\n    plugins: [ ],\n    // a list of plugins registered with the app\n    adminPlugins: [],\n    // processor related\n    // these are the function names for each block from /src/lambda\n    // if you want to add your own lambda, add the function/file name to the list to expose it\n    lambdas: [ ],\n    processors: [ ],\n    tokens: {},\n  },\n  getters: {\n    streamClients: ( state ) => ( streamId ) => {\n      return state.clients.filter( c => c.streamId === streamId )\n    },\n    filteredResources: ( state ) => ( filters, resourceType ) => {\n\n      if ( !resourceType ) resourceType = \"streams\"\n\n      let base = [ ]\n\n      if ( resourceType === \"streams\" )\n        base = state.streams.filter( stream => stream.parent == null && stream.deleted === false )\n\n      if ( resourceType === \"projects\" )\n        base = state.projects.filter( project => project.deleted === false )\n\n      if ( !filters || filters.length === 0 ) return base\n      filters.forEach( query => {\n        query.key = query.key.toLowerCase( )\n        if ( query.value === null ) base = base\n        else {\n          base = base.filter( stream => stream.name !== '' )\n          switch ( query.key ) {\n            case 'private':\n              if ( query.value )\n                base = base.filter( stream => stream.private.toString( ) === query.value )\n              else\n                base = base.filter( stream => stream.private === true )\n              break\n            case 'public':\n              if ( query.value )\n                base = base.filter( stream => ( !stream.private ).toString( ) === query.value )\n              else\n                base = base.filter( stream => stream.private === false )\n              break\n            case 'tag':\n            case 'tags':\n              let myTags = query.value.trim( ).split( ',' ).map( t => t.toLowerCase( ).trim( ) )\n              console.log( myTags )\n              base = base.filter( stream => {\n                let streamTags = stream.tags.map( t => t.toLowerCase( ) )\n                return myTags.every( t => streamTags.includes( t ) )\n              } )\n              break\n            case 'jn':\n              base = base.filter( resource => resource.jobNumber === query.value.trim( ) )\n              break\n            case 'owner':\n              if ( query.value.toLowerCase( ).trim( ) === 'me' ) {\n                base = base.filter( stream => stream.owner === state.user._id )\n              }\n              break;\n            case 'mine':\n              base = base.filter( stream => stream.owner === state.user._id )\n              break;\n            case 'shared':\n              base = base.filter( stream => stream.owner !== state.user._id )\n              break;\n            case 'name':\n              base = base.filter( stream => stream.name ? stream.name.toLowerCase( ).includes( query.value.toLowerCase( ) ) : true )\n              break\n            case 'streamid':\n            case 'id':\n              base = base.filter( stream => stream.streamId.toLowerCase( ).includes( query.value.toLowerCase( ) ) )\n              break\n          }\n        }\n      } )\n      return base\n    },\n    objectPropertyKeys: ( state ) => {\n      let keySet = new Set( )\n      let stringKeySet = new Set( )\n      state.objects.forEach( obj => {\n        if ( !obj.properties ) return\n        let flatProps = flatten( removeArraysRecursive( obj.properties ) )\n        for ( let key in flatProps ) {\n          if ( key === 'hash' || key === 'id' || key.toLowerCase( ).includes( 'hash' ) || key.toLowerCase( ).includes( '_carbon' ) ) continue\n          if ( key.includes( '__' ) ) continue\n          keySet.add( key )\n          if ( typeof flatProps[ key ] === 'string' )\n            stringKeySet.add( key )\n        }\n      } )\n      let keySets = {\n        allKeys: [ ...keySet ].sort( ( a, b ) => { return a.split( '.' ).length - b.split( '.' ).length } ).sort( ( a, b ) => { return a.length - b.length } ),\n        stringKeys: [ ...stringKeySet ].sort( ( a, b ) => { return a.split( '.' ).length - b.split( '.' ).length } ).sort( ( a, b ) => { return a.length - b.length } ),\n      }\n      return keySets\n    },\n    // NOTE: this assumes results from GSA\n    hasStructuralProperties: ( state ) => {\n      for ( let obj of state.objects ) {\n        try {\n          if ( obj.properties.structural.result !== null )\n            return true\n        } catch {}\n      }\n      return false\n    },\n    // NOTE: this assumes results from GSA\n    structuralKeys: ( state ) => {\n      let keys = new Set( )\n      for ( let obj of state.objects ) {\n        try {\n          let props = flatten( getStructuralArrPropKeys( obj.properties.structural.result ) )\n          for ( let key in props )\n            keys.add( key )\n        } catch {}\n      }\n      return [ ...keys ]\n    },\n    allTags: ( state ) => {\n      let tagSet = new Set( )\n      state.streams.forEach( stream => {\n        if ( !stream.deleted )\n          stream.tags.forEach( t => tagSet.add( t ) )\n      } )\n      state.projects.forEach( project => {\n        project.tags.forEach( t => tagSet.add( t ) )\n      } )\n      return [ ...tagSet ]\n    },\n    allStreamTags: ( state ) => {\n      let tagSet = new Set( )\n      state.streams.forEach( stream => {\n        if ( !stream.deleted )\n          stream.tags.forEach( t => tagSet.add( t ) )\n      } )\n      return [ ...tagSet ]\n    },\n    allProjectTags: ( state ) => {\n      let tagSet = new Set( )\n      state.projects.forEach( project => {\n        project.tags.forEach( t => tagSet.add( t ) )\n      } )\n      return [ ...tagSet ]\n    },\n    allJobNumbers: ( state ) => {\n      let set = new Set( )\n      state.streams.forEach( stream => set.add( stream.jobNumber ) )\n      state.projects.forEach( project => set.add( project.jobNumber ) )\n      return [ ...set ]\n    },\n    allJobNumbersStreams: ( state ) => {\n      let set = new Set( )\n      state.streams.forEach( stream => set.add( stream.jobNumber ) )\n      // state.projects.forEach( project => set.add( project.jobNumber ) )\n      return [ ...set ]\n    },\n    allJobNumbersProjects: ( state ) => {\n      let set = new Set( )\n      // state.streams.forEach( stream => set.add( stream.jobNumber ) )\n      state.projects.forEach( project => set.add( project.jobNumber ) )\n      return [ ...set ]\n    }\n  },\n  mutations: {\n    SET_DARK( state, dark ) {\n      state.dark = dark\n    },\n    TOGGLE_VIEWER_CONTROLS( state ) {\n      state.viewerControls = !state.viewerControls\n    },\n    SET_VIEWER_CONTROLS( state, value ) {\n      state.viewerControls = value\n    },\n    // Streams\n    ADD_STREAMS( state, streams ) {\n      streams.forEach( stream => {\n        if ( state.streams.findIndex( x => x.streamId === stream.streamId ) === -1 ) {\n          if ( !stream.description ) stream.description = '...'\n          if ( !stream.tags ) stream.tags = [ ]\n          if ( !stream.jobNumber ) stream.jobNumber = ''\n          state.streams.unshift( stream )\n        }\n      } )\n    },\n    UPDATE_STREAM( state, props ) {\n      let found = state.streams.find( s => s.streamId === props.streamId )\n      if ( !found ) return console.error( 'stream not found; aborting update.' )\n      Object.keys( props ).forEach( key => {\n        found[ key ] = props[ key ]\n      } )\n      found.updatedAt = ( new Date( ) ).toISOString( )\n    },\n    UPDATE_STREAM_DATA( state, props ) {\n      let found = state.streams.find( s => s.streamId === props.streamId )\n      if ( props.layers )\n        found.layers = props.layers\n      found.updatedAt = ( new Date( ) ).toISOString( )\n      // console.log('TODO')\n    },\n    DELETE_STREAM( state, stream ) {\n      let index = state.streams.findIndex( s => s.streamId === stream.streamId )\n      if ( index > -1 ) {\n        state.streams.splice( index, 1 )\n      } else\n        console.log( `Failed to remove stream ${stream.streamId} from store.` )\n    },\n\n    // Clients\n    ADD_CLIENTS( state, clients ) {\n      clients.forEach( client => {\n        if ( state.clients.findIndex( x => x._id === client._id ) === -1 ) {\n          state.clients.push( client )\n        }\n      } )\n    },\n\n    ADD_DE_STREAM( state, stream ) {\n      let found = state.deStreams.find( s => s.streamId === stream )\n      if ( !found )\n        state.deStreams.push( stream )\n      else {\n        found.layers = stream.layers\n        found.objects = stream.objects\n      }\n    },\n    ADD_DE_STREAM_LAYER( state, stream ) {\n      console.log( stream )\n      let found = state.deStreams.find( s => s.streamId === stream.streamId )\n      let newLayer = {\n        name: `Param group ${found.layers.length + 1}`,\n        orderIndex: found.layers.length,\n        startIndex: found.objects.length,\n        objectCount: 0,\n        topology: \"0-0\",\n        guid: uuid( ),\n      }\n      found.layers.push( newLayer )\n    },\n    UPDATE_DE_STREAM_LAYER( state, { streamId, layer, objects } ) {\n      let found = state.deStreams.find( s => s.streamId === streamId )\n      let surpassed = false,\n        objectCountDifference = 0\n\n      found.layers.forEach( iterLayer => {\n        if ( surpassed ) {\n          iterLayer.startIndex += objectCountDifference\n        } else if ( iterLayer.guid === layer.guid ) {\n          iterLayer.name = layer.name\n          iterLayer.topology = `0-${objects.length}`\n          objectCountDifference = objects.length - iterLayer.objectCount\n          found.objects.splice( iterLayer.startIndex, iterLayer.objectCount, ...objects )\n          iterLayer.objectCount = objects.length\n          surpassed = true\n        }\n      } )\n    },\n    REMOVE_DE_STREAM_LAYER( state, { streamId, layer } ) {\n      let found = state.deStreams.find( s => s.streamId === streamId )\n      // dump objects\n      found.objects.splice( layer.startIndex, layer.objectCount )\n      // adjust start indexes\n      let surpassed = false\n      found.layers.forEach( iterLayer => {\n        if ( surpassed ) {\n          iterLayer.startIndex -= layer.objectCount\n          iterLayer.orderIndex -= 1\n        } else if ( iterLayer.guid === layer.guid ) surpassed = true\n      } )\n      // dump layer\n      found.layers = found.layers.filter( l => l.guid !== layer.guid )\n    },\n    APPEND_DE_STREAM_LAYERS_FROM_CSV( state, { streamId, transposed } ) {\n      let found = state.deStreams.find( s => s.streamId === streamId )\n      let index = 0\n      for ( let arr of transposed ) {\n        let newLayer = {\n          name: arr[ 0 ] !== '' ? arr[ 0 ] : \"Unnamed\",\n          orderIndex: -1, // to be set properly afterwards\n          startIndex: index === 0 ? found.objects.length : found.objects.length,\n          objectCount: arr.length - 1,\n          topology: `0-${arr.length-1}`,\n          guid: uuid( ),\n        }\n        found.layers.push( newLayer )\n        let noHeader = arr.slice( 1, arr.length )\n        console.log( noHeader )\n        found.objects.push( ...noHeader.map( val => {\n          if ( !val ) return { type: \"Null\", value: \"\" }\n          if ( typeof val === 'boolean' )\n            return { type: \"Boolean\", value: val }\n          if ( typeof val === 'number' )\n            return { type: \"Number\", value: val } // TODO: Hash it please\n          if ( typeof val === 'string' )\n            return { type: \"String\", value: val } // TODO: Hash it please\n        } ) )\n        index++\n      }\n      found.layers.forEach( ( layer, k ) => {\n        console.log( k )\n        layer.orderIndex = k\n      } )\n    },\n    // Projects\n    ADD_PROJECTS( state, projects ) {\n      projects.forEach( project => {\n        if ( state.projects.findIndex( p => p._id === project._id ) === -1 ) {\n          // potentially enforce here extra fields\n          if ( !project.tags ) project.tags = [ ]\n          if ( !project.deleted ) project.deleted = false\n          if ( !project.jobNumber ) project.jobNumber = ''\n          state.projects.unshift( project )\n        }\n      } )\n    },\n    UPDATE_PROJECT( state, props ) {\n      let found = state.projects.find( p => p._id === props._id )\n      if ( found == null ) return console.warn( 'The admin user is not on this project' )\n      Object.keys( props ).forEach( key => {\n        found[ key ] = props[ key ]\n      } )\n      found.updatedAt = ( new Date( ) ).toISOString( )\n    },\n    DELETE_PROJECT( state, props ) {\n      let index = state.projects.findIndex( p => p._id === props._id )\n      if ( index > -1 ) {\n        state.projects.splice( index, 1 )\n      } else\n        console.log( `Failed to remove project ${props._id} from store.` )\n    },\n\n    // Processors\n    ADD_LAMBDAS( state, lambdas ) {\n      lambdas.forEach( lambda => {\n        if ( state.lambdas.findIndex( p => p.function === lambda.function ) === -1 ) {\n          state.lambdas.push( lambda )\n        }\n      } )\n    },\n    ADD_PROCESSORS( state, processors ) {\n      processors.forEach( processor => {\n        if ( state.processors.findIndex( p => p._id === processor._id ) === -1 ) {\n          // potentially enforce here extra fields\n          if ( !processor.tags ) processor.tags = [ ]\n          state.processors.unshift( processor )\n        }\n      } )\n    },\n    UPDATE_PROCESSOR( state, props ) {\n      let found = state.processors.find( p => p._id == props._id )\n\n      Object.keys( props ).forEach( key => {\n        found[ key ] = props[ key ]\n      } )\n    },\n    DELETE_PROCESSOR( state, props ) {\n      let index = state.processors.findIndex( p => p._id === props._id )\n      if ( index > -1 ) {\n        state.processors.splice( index, 1 )\n      } else\n        console.log( `Failed to remove processor ${props._id} from store.` )\n    },\n    ADD_TOKEN( state, { id, token } ) {\n      Vue.set( state.tokens, id, token )\n      console.log( state.tokens )\n    },\n    DELETE_TOKEN( state, id ) {\n      Vue.delete( state.tokens, id )\n      console.log( state.tokens )\n    },\n\n    // Users\n    ADD_USER( state, user ) {\n      let found = state.users.find( u => u._id === user._id )\n      if ( !found )\n        state.users.unshift( user )\n      else found = user // update the user\n    },\n    ADD_USERS( state, users ) {\n      users.forEach( user => {\n        let found = state.users.find( u => u._id === user._id )\n        if ( !found )\n          state.users.unshift( user )\n        else found = user // update the user\n      } )\n    },\n    UPDATE_USER( state, user ) {\n      let found = null\n      if ( user._id === state.user._id ) found = state.user\n      else\n        found = state.users.find( u => u._id === user._id )\n      if ( !found )\n        return console.error( 'User not found; aborting update.' )\n      Object.keys( user ).forEach( key => {\n        found[ key ] = user[ key ]\n      } )\n    },\n\n    // Generics\n    SET_SERVER( state, server ) {\n      state.server = server\n    },\n    SET_SERVER_DETAILS( state, serverManifest ) {\n      state.serverManifest = serverManifest\n    },\n    SET_TOKEN( state, token ) {\n      state.token = token\n      state.isAuth = true\n    },\n    SET_USER( state, user ) {\n      state.user = user\n    },\n    SET_WEB_APP_CLIENT( state, client ) {\n      state.client = client\n    },\n\n    // End of life\n    FLUSH_ALL( state ) {\n      state.token = null\n      state.user = {}\n      state.streams = [ ]\n      state.projects = [ ]\n      state.clients = [ ]\n      state.users = [ ]\n      state.comments = [ ]\n      state.isAuth = false\n      state.server = null\n    },\n\n    // Viewer related\n    ADD_LOADED_STREAMID( state, streamId ) {\n      state.loadedStreamIds = [ ...new Set( [ ...state.loadedStreamIds, streamId ] ) ]\n    },\n    REMOVE_LOADED_STREAMID( state, streamId ) {\n      let index = state.loadedStreamIds.indexOf( streamId )\n      if ( index !== -1 )\n        state.loadedStreamIds.splice( index, 1 )\n      else\n        console.warn( `Failed to remove loaded streamid: ${streamId} from ${state.loadedStreamIds}` )\n    },\n    // OBJECTS\n    ADD_OBJECTS( state, objects ) {\n      state.objects.push( ...objects )\n    },\n    UPDATE_OBJECTS_STREAMS( state, { objIds, streamToAdd, streamToRemove } ) {\n      objIds.forEach( id => {\n        let myObject = state.objects.find( o => o._id === id )\n        if ( myObject ) {\n          if ( streamToAdd && myObject.streams.indexOf( streamToAdd ) === -1 )\n            myObject.streams.push( streamToAdd )\n          if ( streamToRemove ) {\n            let index = myObject.streams.indexOf( streamToRemove )\n            if ( index !== -1 ) myObject.streams.splice( index, 1 )\n          }\n        }\n      } )\n    },\n    REMOVE_OBJECTS( state, objectIds ) {\n      state.objects = state.objects.filter( obj => objectIds.indexOf( obj._id ) === -1 )\n    },\n    // Selected objects setters\n    SET_SELECTED_OBJECTS( state, { objectIds } ) {\n      if ( objectIds.length > 0 )\n        state.selectedObjects = [ ...new Set( [ ...state.selectedObjects, ...objectIds ] ) ]\n      else\n        state.selectedObjects = [ ]\n    },\n    ADD_SELECTED_OBJECTS( state, { objectIds } ) {\n      state.selectedObjects = [ ...new Set( [ ...state.selectedObjects, ...objectIds ] ) ]\n    },\n    REMOVE_SELECTED_OBJECTS( state, { objectIds } ) {\n      objectIds.forEach( id => {\n        let index = state.selectedObjects.indexOf( id )\n        if ( index !== -1 ) state.selectedObjects.splice( index, 1 )\n      } )\n    },\n    SET_LEGEND( state, legend ) {\n      state.legend = legend\n    },\n    ADD_PLUGIN( state, plugin ) {\n      state.plugins.push( plugin )\n    }\n  },\n  actions: {\n    // Streams\n    getStream( context, props ) {\n      return new Promise( ( resolve, reject ) => {\n        let found = context.state.streams.find( s => s.streamId === props.streamId )\n        if ( found ) return resolve( found )\n        Axios.get( `streams/${props.streamId}?omit=objects` )\n          .then( res => {\n            context.commit( 'ADD_STREAMS', [ res.data.resource ] )\n            return resolve( res )\n          } )\n          .catch( err => {\n            return reject( err )\n          } )\n      } )\n    },\n\n    refreshStream( context, props ) {\n      return new Promise( ( resolve, reject ) => {\n        Axios.get( `streams/${props.streamId}?omit=objects` )\n          .then( res => {\n            context.commit( 'UPDATE_STREAM', res.data.resource )\n            return resolve( res )\n          } )\n          .catch( err => reject( err ) )\n      } )\n    },\n\n    getStreams( context, query ) {\n      return new Promise( ( resolve, reject ) => {\n        Axios.get( `streams?${query ? query : '' }` )\n          .then( res => {\n            context.commit( 'ADD_STREAMS', res.data.resources )\n            return resolve( res.data.resources )\n          } )\n          .catch( err => {\n            console.log( err )\n            return reject( err )\n          } )\n      } )\n    },\n    createStream( context, stream ) {\n      let streamId = null\n      return new Promise( ( resolve, reject ) => {\n        Axios.post( `streams` )\n          .then( res => {\n            console.log( res )\n            stream.streamId = res.data.resource.streamId\n            res.data.resource.onlineEditable = true\n            context.commit( 'ADD_STREAMS', [ res.data.resource ] )\n            //namespacing the admin module caused other issues, so we'll call this here as well\n            context.commit( 'ADD_STREAMS_ADMIN', [ res.data.resource ] )\n            return Axios.put( `streams/${res.data.resource.streamId}`, stream )\n          } )\n          .then( res => {\n            console.log( res )\n            context.commit( 'UPDATE_STREAM', stream )\n            return resolve( stream )\n          } )\n          .catch( err => {\n            console.error( err )\n            return reject( err )\n          } )\n      } )\n    },\n    updateStream( context, props ) {\n      Axios.put( `streams/${props.streamId}`, props )\n        .then( res => {\n          // modules.admin\n          context.commit( 'UPDATE_STREAM', props )\n        } )\n        .catch( err => {\n          console.warn( err )\n        } )\n    },\n    // For data-editable streams only\n    updateStreamObjectsAndLayers: ( context, { streamId, commitMessage } ) => new Promise( ( resolve, reject ) => {\n      let found = context.state.deStreams.find( s => s.streamId === streamId )\n      if ( !found ) return reject( new Error( 'Stream not found in store.' ) )\n\n      found.commitMessage = commitMessage + ` (changed by ${context.state.user.name} ${context.state.user.surname})`\n      found.lastChangedBy = context.state.user._id\n\n      context.commit( 'UPDATE_STREAM', { streamId: streamId, commitMessage: commitMessage } )\n\n      Axios.post( `streams/${streamId}/clone` )\n        .then( res => {\n          let originalStream = context.state.streams.find( s => s.streamId === streamId )\n          context.commit( 'UPDATE_STREAM', { streamId: streamId, children: [ ...originalStream.children, res.data.clone.streamId ] } )\n          return Axios.put( `streams/${streamId}`, found )\n        } )\n        .then( res => resolve( res ) )\n        .catch( err => reject( err ) )\n    } ),\n    getStreamClients( context, props ) {\n      Axios.get( `streams/${props.streamId}/clients` )\n        .then( res => {\n          context.commit( 'ADD_CLIENTS', res.data.resources )\n        } )\n        .catch( err => {\n          console.log( err )\n        } )\n    },\n    deleteStream( context, payload ) {\n      // TODO: https://github.com/speckleworks/SpeckleAdmin/issues/19\n      Axios.delete( `streams/${payload.streamId}` )\n        .then( res => {\n          context.commit( 'DELETE_STREAM', { streamId: payload.streamId } )\n        } )\n        .catch( err => {\n          console.log( err )\n        } )\n    },\n\n    // objects\n    getStreamObjects( context, streamId ) {\n      let found = context.state.streams.find( s => s.streamId === streamId )\n      return new Promise( ( resolve, reject ) => {\n        context.dispatch( 'getStream', { streamId: streamId } )\n          .then( ( ) => {\n            return Axios.get( `streams/${streamId}?fields=objects,layers` )\n          } )\n          .then( res => {\n            let ids = res.data.resource.objects.map( o => o._id )\n            context.commit( 'UPDATE_STREAM', { streamId: streamId, objects: ids, layers: res.data.resource.layers } )\n            resolve( ids )\n          } )\n          .catch( err => {\n            reject( err )\n          } )\n      } )\n    },\n    getObjects( context, objectIds ) {\n      return new Promise( ( resolve, reject ) => {\n        Axios.post( `objects/getbulk?omit=base64,rawData,canRead,canWrite,children,anonymousComments,name`, objectIds )\n          .then( res => {\n            // context.state.objects.push( ...res.data.resources )\n            // context.commit( 'ADD_OBJECTS', res.data.resources )\n            resolve( res.data.resources )\n          } )\n          .catch( err => reject( err ) )\n      } )\n    },\n    createObjects( context, objects ) {\n      return new Promise( ( resolve, reject ) => {\n        Axios.post( `objects`, objects )\n          .then( res => resolve( res.data.resources ) )\n          .catch( err => reject( err ) )\n      } )\n    },\n\n    // projects\n    getProject( context, props ) {\n      return new Promise( ( resolve, reject ) => {\n        Axios.get( `projects/${props._id}` )\n          .then( res => {\n            context.commit( 'ADD_PROJECTS', [ res.data.resource ] )\n            return resolve( res )\n          } )\n          .catch( err => {\n            console.error( err )\n            return reject( err )\n          } )\n      } )\n    },\n    getProjects( context, query ) {\n      return new Promise( ( resolve, reject ) => {\n        Axios.get( `projects?${query ? query : '' }` )\n          .then( res => {\n            context.commit( 'ADD_PROJECTS', res.data.resources )\n            return resolve( res.data.resources )\n          } )\n          .catch( err => {\n            console.log( err )\n            return reject( err )\n          } )\n      } )\n    },\n    createProject( context, project ) {\n      return new Promise( ( resolve, reject ) => {\n        Axios.post( `projects`, project ? project : { name: 'A new speckle project' } )\n          .then( res => {\n            context.commit( 'ADD_PROJECTS', [ res.data.resource ] )\n            //namespacing the admin module caused other issues, so we'll call this here as well\n            context.commit( 'ADD_PROJECTS_ADMIN', [ res.data.resource ] )\n            return resolve( res.data.resource )\n          } )\n          .catch( err => {\n            console.log( err )\n            return reject( err )\n          } )\n      } )\n    },\n    updateProject( context, props ) {\n      Axios.put( `projects/${props._id}`, props )\n        .then( res => {\n          context.commit( 'UPDATE_PROJECT', props )\n        } )\n        .catch( err => {\n          console.warn( err )\n        } )\n    },\n    addUserToProject: ( context, { projectId, userId } ) => new Promise( ( resolve, reject ) => {\n      let project = context.state.projects.find( p => p._id === projectId )\n      if ( !project ) return reject( new Error( 'Failed to find project in state.' ) )\n\n      Axios.put( `projects/${projectId}/adduser/${userId}` )\n        .then( res => {\n          let permissions = { canWrite: [ ...new Set( [ ...project.permissions.canWrite, userId ] ) ], canRead: project.permissions.canRead }\n          let canRead = [ ...new Set( [ ...project.canRead, userId ] ) ]\n          context.commit( 'UPDATE_PROJECT', { _id: projectId, permissions: permissions, canRead: canRead } )\n          project.streams.forEach( streamId => {\n            let myStream = context.state.streams.find( s => s.streamId === streamId )\n            context.commit( 'UPDATE_STREAM', { streamId: streamId, canWrite: uniq( [ ...myStream.canWrite, userId ] ) } )\n          } )\n          return resolve( )\n        } )\n        .catch( err => {\n          console.warn( err )\n          return reject( err )\n        } )\n    } ),\n    upgradeUserInProject: ( context, { projectId, userId } ) => new Promise( ( resolve, reject ) => {\n      let project = context.state.projects.find( p => p._id === projectId )\n      if ( !project ) return reject( new Error( 'Failed to find project in state.' ) )\n      Axios.put( `projects/${projectId}/upgradeuser/${userId}` )\n        .then( res => {\n          return Axios.get( `projects/${projectId}?fields=permissions` )\n        } )\n        .then( res => {\n          context.commit( 'UPDATE_PROJECT', {\n            _id: projectId,\n            permissions: {\n              canRead: res.data.resource.permissions.canRead, //[ ...new Set( [ ...project.canRead, userId ] ) ],\n              canWrite: res.data.resource.permissions.canWrite //[ ...new Set( [ ...project.canWrite, userId ] ) ]\n            }\n          } )\n          project.streams.forEach( streamId => {\n            let myStream = context.state.streams.find( s => s.streamId === streamId )\n            context.commit( 'UPDATE_STREAM', { streamId: streamId, canWrite: uniq( [ ...myStream.canWrite, userId ] ), canRead: uniq( [ ...myStream.canRead, userId ] ) } )\n          } )\n          return resolve( )\n        } )\n        .catch( err => {\n          console.warn( err )\n          return reject( err )\n        } )\n    } ),\n    downgradeUserInProject: ( context, { projectId, userId } ) => new Promise( ( resolve, reject ) => {\n      let project = context.state.projects.find( p => p._id === projectId )\n      if ( !project ) return reject( new Error( 'Failed to find project in state.' ) )\n      Axios.put( `projects/${projectId}/downgradeuser/${userId}` )\n        .then( res => {\n          context.commit( 'UPDATE_PROJECT', { _id: projectId, permissions: res.data.project.permissions } )\n          res.data.streamsToAddReadAndPullWrite.forEach( streamId => {\n            let myStream = context.state.streams.find( s => s.streamId === streamId )\n            context.commit( 'UPDATE_STREAM', { streamId: streamId, canWrite: myStream.canWrite.filter( id => id !== userId ), canRead: uniq( [ ...myStream.canRead, userId ] ) } )\n          } )\n          res.data.streamsToAddToRead.forEach( streamId => {\n            let myStream = context.state.streams.find( s => s.streamId === streamId )\n            context.commit( 'UPDATE_STREAM', { streamId: streamId, canRead: uniq( [ ...myStream.canRead, userId ] ) } )\n          } )\n          return resolve( )\n        } )\n        .catch( err => {\n          console.warn( err )\n          return reject( err )\n        } )\n    } ),\n    removeUserInProject: ( context, { projectId, userId } ) => new Promise( ( resolve, reject ) => {\n      let project = context.state.projects.find( p => p._id === projectId )\n      if ( !project ) return reject( new Error( 'Failed to find project in state.' ) )\n      Axios.delete( `projects/${projectId}/removeuser/${userId}` )\n        .then( res => {\n          context.commit( 'UPDATE_PROJECT', { _id: projectId, canRead: res.data.project.canRead, canWrite: res.data.project.canWrite, permissions: res.data.project.permissions } )\n          res.data.streamsToPullBothFrom.forEach( streamId => {\n            let myStream = context.state.streams.find( s => s.streamId === streamId )\n            context.commit( 'UPDATE_STREAM', { streamId: streamId, canRead: myStream.canRead.filter( id => id !== userId ), canWrite: myStream.canWrite.filter( id => id !== userId ) } )\n          } )\n          res.data.streamsToPullWriteFrom.forEach( streamId => {\n            let myStream = context.state.streams.find( s => s.streamId === streamId )\n            context.commit( 'UPDATE_STREAM', { streamId: streamId, canWrite: myStream.canWrite.filter( id => id !== userId ) } )\n          } )\n          res.data.streamsToPullReadFrom.forEach( streamId => {\n            let myStream = context.state.streams.find( s => s.streamId === streamId )\n            context.commit( 'UPDATE_STREAM', { streamId: streamId, canRead: myStream.canRead.filter( id => id !== userId ) } )\n          } )\n          return resolve( )\n        } )\n        .catch( err => {\n          console.warn( err )\n          return reject( err )\n        } )\n    } ),\n    addStreamToProject: ( context, { projectId, streamId } ) => new Promise( ( resolve, reject ) => {\n      let project = context.state.projects.find( p => p._id === projectId )\n      if ( !project ) return reject( new Error( 'Failed to find project in state.' ) )\n\n      Axios.put( `projects/${projectId}/addstream/${streamId}` )\n        .then( res => {\n          context.commit( 'UPDATE_PROJECT', { _id: projectId, streams: res.data.project.streams } )\n          context.commit( 'UPDATE_STREAM', { streamId: streamId, canRead: res.data.stream.canRead, canWrite: res.data.stream.canWrite } )\n          return resolve( )\n        } )\n        .catch( err => {\n          console.warn( err )\n          return reject( err )\n        } )\n    } ),\n    removeStreamFromProject: ( context, { projectId, streamId } ) => new Promise( ( resolve, reject ) => {\n      let project = context.state.projects.find( p => p._id === projectId )\n      if ( !project ) return reject( new Error( 'Failed to find project in state.' ) )\n\n      Axios.delete( `projects/${projectId}/removestream/${streamId}` )\n        .then( res => {\n          context.commit( 'UPDATE_PROJECT', { _id: projectId, streams: res.data.project.streams } )\n          context.commit( 'UPDATE_STREAM', { streamId: streamId, canRead: res.data.stream.canRead, canWrite: res.data.stream.canWrite } )\n          return resolve( )\n        } )\n        .catch( err => {\n          console.warn( err )\n          return reject( err )\n        } )\n    } ),\n    deleteProject: ( context, props ) => new Promise( ( resolve, reject ) => {\n      Axios.delete( `projects/${props._id}` )\n        .then( res => {\n          context.commit( 'DELETE_PROJECT', { _id: props._id } )\n          for ( let stream of res.data.modifiedStreams ) {\n            context.commit( 'UPDATE_STREAM', { streamId: stream.streamId, canRead: stream.canRead, canWrite: stream.canWrite } )\n          }\n          return resolve( )\n        } )\n        .catch( err => {\n          console.warn( err )\n          return reject( err )\n        } )\n    } ),\n\n    // processors\n    loadLambdas( context ) {\n      return new Promise( ( resolve, reject ) => {\n        let promises = [ ]\n        let myLambdas = new LambdaSettings( ).Lambdas\n\n        for ( let i = 0; i < myLambdas.length; i++ ) {\n          promises.push(\n            Axios( {\n              method: 'GET',\n              url: `.netlify/functions/${myLambdas[i]}`,\n              baseURL: location.protocol + '//' + location.host,\n            } ).catch( err => console.log( `Failed to load lambda: ${myLambdas[i]}` ) )\n          )\n        }\n\n        Promise.all( promises )\n          .then( res => {\n            var lambdas = [ ]\n\n            res.forEach( r => {\n              if ( r ) {\n                let data = r.data\n                data.function = r.request.responseURL.split( '/' ).slice( -1 ).pop( )\n                lambdas.push( data )\n              }\n            } )\n\n            context.commit( 'ADD_LAMBDAS', lambdas )\n            return resolve( lambdas )\n          } )\n      } )\n\n\n    },\n    getProcessor( context, props ) {\n      var processor = JSON.parse( window.localStorage.getItem( \"processor_\" + props._id ) )\n\n      if ( processor !== null )\n        context.commit( 'ADD_PROCESSORS', [ processor ] )\n\n      return processor\n    },\n    getProcessors( context ) {\n      var processorIds = JSON.parse( window.localStorage.getItem( \"processorIds\" ) )\n\n      if ( processorIds === null )\n        return null\n\n      var processors = [ ]\n      processorIds.forEach( id => {\n        var processor = JSON.parse( window.localStorage.getItem( \"processor_\" + id ) )\n        if ( processor != null )\n          processors.unshift( processor )\n      } )\n\n      context.commit( 'ADD_PROCESSORS', processors )\n\n      return processors\n    },\n    createProcessor( context, processor ) {\n      var id = uuid( )\n\n      var proc = processor ? processor : { name: 'A new speckle processor' }\n\n      // Always assign new ID\n      proc._id = id\n\n      if ( !proc.hasOwnProperty( 'description' ) )\n        proc.description = \"This is a simple speckle processor.\"\n\n      if ( !proc.hasOwnProperty( 'tags' ) )\n        proc.tags = [ ]\n\n      if ( !proc.hasOwnProperty( 'blocks' ) )\n        proc.blocks = [ ]\n\n      if ( !proc.hasOwnProperty( 'params' ) )\n        proc.params = [ ]\n\n      // Properties added for compatibility with other components\n      // as well as for future storage in server\n      proc.owner = context.state.user._id\n      proc.private = false\n      proc.canRead = [ context.state.user._id ]\n      proc.canWrite = [ context.state.user._id ]\n\n      proc.anonymousComments = false\n      proc.comments = [ ]\n\n      window.localStorage.setItem(\n        \"processor_\" + id,\n        JSON.stringify( proc )\n      )\n\n      context.commit( 'ADD_PROCESSORS', [ proc ] )\n\n      var processorIds = JSON.parse( window.localStorage.getItem( \"processorIds\" ) )\n\n      if ( processorIds === null )\n        processorIds = [ ]\n\n      processorIds.unshift( id )\n\n      window.localStorage.setItem(\n        \"processorIds\",\n        JSON.stringify( processorIds )\n      )\n\n      return proc\n    },\n    updateProcessor( context, props ) {\n      let found = JSON.parse( window.localStorage.getItem( \"processor_\" + props._id ) )\n\n      Object.keys( props ).forEach( key => {\n        found[ key ] = props[ key ]\n      } )\n      window.localStorage.setItem(\n        \"processor_\" + props._id,\n        JSON.stringify( found )\n      )\n\n      context.commit( 'UPDATE_PROCESSOR', props )\n    },\n    deleteProcessor( context, props ) {\n      window.localStorage.removeItem( \"processor_\" + props._id )\n\n      context.commit( 'DELETE_PROCESSOR', props )\n\n      var processorIds = JSON.parse( window.localStorage.getItem( \"processorIds\" ) )\n\n      if ( processorIds !== null ) {\n        var foundIndex = processorIds.indexOf( props._id )\n        if ( foundIndex !== -1 ) {\n          processorIds.splice( foundIndex, 1 )\n\n          window.localStorage.setItem(\n            \"processorIds\",\n            JSON.stringify( processorIds )\n          )\n        }\n      }\n    },\n    async authenticateBlocks( context, blocks ) {\n      for ( let i = 0; i < blocks.length; i++ ) {\n        if ( blocks[ i ].msal ) {\n          let propName = 'msal|' + blocks[ i ].msal.clientId\n          let token = await getTokenMSAL( blocks[ i ].msal )\n          context.commit( 'ADD_TOKEN', { id: propName, token: token } )\n        }\n      }\n    },\n\n    // client for ws ids, etc.\n    createClient: ( context, props ) => new Promise( ( resolve, reject ) => {\n\n      // NOTE: This is a stupid hack. To get a temp client, we need to be not auhtorised : /\n      delete Axios.defaults.headers.common[ 'Authorization' ]\n\n      Axios.post( `clients`, { role: 'online-client', documentName: 'Online interface', documentType: 'browser', online: true } )\n        .then( res => {\n          context.commit( 'SET_WEB_APP_CLIENT', res.data.resource )\n          return resolve( res.data.resource )\n        } )\n        .catch( err => {\n          console.warn( err )\n          return reject( err )\n        } )\n      // set the headers back. man what a stupid hack this is...\n      Axios.defaults.headers.common[ 'Authorization' ] = context.state.token\n    } ),\n\n    // users\n    getUser( context, payload ) {\n      return new Promise( ( resolve, reject ) => {\n        let found = context.state.users.find( u => u._id === payload._id )\n        if ( found ) return resolve( found )\n        Axios.get( `accounts/${payload._id}` )\n          .then( res => {\n            if ( context.state.user._id === payload._id ) res.data.resource.surname += ' (that is you!)'\n            context.commit( 'ADD_USER', res.data.resource )\n            return resolve( res.data.resource )\n          } )\n          .catch( err => {\n            return reject( err )\n          } )\n      } )\n    },\n\n    getPlugins( context, payload ) {\n      Axios.get()\n        .then( res => {\n          const plugins = res.data.plugins\n          plugins.forEach( plugin => {\n            context.commit( 'ADD_PLUGIN', plugin )\n          })\n        })\n        .catch ( err => {\n          console.warn ( err )\n          return reject ( err )\n        })\n    },\n\n    updateLoggedInUser: ( context, payload ) => new Promise( ( resolve, reject ) => {\n      console.log( payload )\n      Axios.put( `accounts`, payload )\n        .then( res => {\n          context.commit( 'UPDATE_USER', payload )\n          return resolve( res )\n        } )\n        .catch( err => reject( err ) )\n    } ),\n\n    // Auth\n    authenticate: ( context, payload ) => new Promise( async ( resolve, reject ) => {\n      try {\n        let userProfile = await Axios.get( new URL( \"/api/accounts\", payload.server ), { headers: { 'Authorization': payload.token } } )\n        console.log( userProfile )\n        context.commit( 'SET_TOKEN', payload.token )\n        context.commit( 'SET_USER', userProfile.data.resource )\n        context.commit( 'SET_SERVER', new URL( \"/api\", payload.server ) )\n\n        let serverDetails = await Axios.get( `${payload.server}/api` )\n        context.commit( 'SET_SERVER_DETAILS', serverDetails.data )\n\n        Axios.defaults.headers.common[ 'Authorization' ] = payload.token\n        Axios.defaults.baseURL = `${payload.server}/api`\n\n        localStorage.setItem( 'currentServer', `${payload.server}/api` )\n        localStorage.setItem( 'token', payload.token )\n\n        let usedServers = localStorage.getItem( 'allSpeckleServers' ) ? new Set( localStorage.getItem( 'allSpeckleServers' ).split( ',' ) ) : new Set( [ `${payload.server}/api` ] )\n        // if( !usedServers ) usedServers = new Set([`${payload.server}/api`])\n        usedServers.add( `${payload.server}/api` )\n        console.log( `${payload.server}/api` )\n        console.log( usedServers )\n        localStorage.setItem( 'allSpeckleServers', [ ...usedServers ] )\n\n        return resolve( )\n      } catch ( err ) {\n        console.log( err )\n        return reject( err.message )\n      }\n    } ),\n\n    logout( context, payload ) {\n      context.commit( 'FLUSH_ALL' )\n      localStorage.removeItem( 'token' )\n      localStorage.removeItem( 'viewerSettings' )\n      localStorage.removeItem( 'currentServer' )\n      Axios.defaults.headers.common[ 'Authorization' ] = ''\n      Axios.defaults.baseURL = ''\n    }\n  },\n  modules: {\n    admin: admin,\n    viewer: viewer,\n  }\n} )\n"]}]}