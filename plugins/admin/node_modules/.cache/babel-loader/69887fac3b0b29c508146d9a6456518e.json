{"remainingRequest":"/Users/donnykurnia/data/Projects/upwork/3dbyggeri/glasshouse/SpeckleServer/plugins/admin/node_modules/thread-loader/dist/cjs.js!/Users/donnykurnia/data/Projects/upwork/3dbyggeri/glasshouse/SpeckleServer/plugins/admin/node_modules/babel-loader/lib/index.js!/Users/donnykurnia/data/Projects/upwork/3dbyggeri/glasshouse/SpeckleServer/plugins/admin/node_modules/cache-loader/dist/cjs.js??ref--0-0!/Users/donnykurnia/data/Projects/upwork/3dbyggeri/glasshouse/SpeckleServer/plugins/admin/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/donnykurnia/data/Projects/upwork/3dbyggeri/glasshouse/SpeckleServer/plugins/admin/src/components/PermissionTableProject.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/donnykurnia/data/Projects/upwork/3dbyggeri/glasshouse/SpeckleServer/plugins/admin/src/components/PermissionTableProject.vue","mtime":1609071089409},{"path":"/Users/donnykurnia/data/Projects/upwork/3dbyggeri/glasshouse/SpeckleServer/plugins/admin/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/donnykurnia/data/Projects/upwork/3dbyggeri/glasshouse/SpeckleServer/plugins/admin/node_modules/thread-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/donnykurnia/data/Projects/upwork/3dbyggeri/glasshouse/SpeckleServer/plugins/admin/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/donnykurnia/data/Projects/upwork/3dbyggeri/glasshouse/SpeckleServer/plugins/admin/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/donnykurnia/data/Projects/upwork/3dbyggeri/glasshouse/SpeckleServer/plugins/admin/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["import \"core-js/modules/es6.array.find\";\nimport _toConsumableArray from \"/Users/donnykurnia/data/Projects/upwork/3dbyggeri/glasshouse/SpeckleServer/plugins/admin/node_modules/@babel/runtime-corejs2/helpers/esm/toConsumableArray\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport union from 'lodash.union';\nimport uniq from 'lodash.uniq';\nimport UserPermCard from '@/components/UserPermissionProjectCard.vue';\nexport default {\n  name: 'PermissionTable',\n  components: {\n    UserPermCard: UserPermCard\n  },\n  props: {\n    project: Object,\n    globalDisabled: {\n      type: Boolean,\n      default: false\n    }\n  },\n  computed: {\n    canEdit: function canEdit() {\n      return this.project.owner === this.$store.state.user._id || this.project.canWrite.indexOf(this.$store.state.user._id) > -1 || this.$store.state.user.role === 'admin';\n    },\n    canReadProject: function canReadProject() {\n      return this.project.canRead;\n    },\n    canWriteProject: function canWriteProject() {\n      return this.project.canWrite;\n    },\n    canReadStreams: function canReadStreams() {\n      return this.project.permissions.canRead;\n    },\n    canWriteStreams: function canWriteStreams() {\n      return this.project.permissions.canWrite;\n    },\n    allUsers: function allUsers() {\n      return uniq([].concat(_toConsumableArray(this.canReadProject), _toConsumableArray(this.canWriteProject), _toConsumableArray(this.canReadStreams), _toConsumableArray(this.canWriteProject), [this.project.owner]));\n    },\n    allUsersPop: function allUsersPop() {\n      var _this = this;\n\n      if (this.allUsers.length === 0) return [];\n      return this.allUsers.map(function (userId) {\n        var u = _this.$store.state.users.find(function (user) {\n          return user._id === userId;\n        });\n\n        if (!u) _this.$store.dispatch('getUser', {\n          _id: userId\n        });\n        if (u) u.isOwner = u._id === _this.project.owner;\n        return u;\n      }); //.sort( ( a, b ) => a.name > b.name ? 1 : -1 )\n    }\n  },\n  data: function data() {\n    return {};\n  },\n  methods: {\n    hasWritePermissionStreams: function hasWritePermissionStreams(_id) {\n      return this.canWriteStreams.indexOf(_id) > -1;\n    },\n    hasWritePermissionProject: function hasWritePermissionProject(_id) {\n      return this.canWriteProject.indexOf(_id) > -1;\n    },\n    changePermissionProject: function changePermissionProject(userId) {\n      var canWrite = this.project.canWrite.indexOf(userId) > -1 ? true : false;\n      var localCanWrite = [],\n          localCanRead = [],\n          streamCanWrite = this.project.permissions.canWrite,\n          streamCanRead = this.project.permissions.canRead;\n\n      if (canWrite) {\n        localCanWrite = this.project.canWrite.filter(function (uId) {\n          return uId !== userId;\n        });\n        localCanRead = uniq([].concat(_toConsumableArray(this.project.canRead), [userId]));\n      } else {\n        localCanRead = this.project.canRead;\n        localCanWrite = uniq([].concat(_toConsumableArray(this.project.canWrite), [userId])); // TODO: UPGRADE STREAMS CANWRITE TOO (otherwise user x can edit the project but not do much)\n\n        streamCanWrite = uniq([].concat(_toConsumableArray(streamCanWrite), [userId]));\n        this.upgradeUser(userId);\n      }\n\n      this.$store.dispatch('updateProject', {\n        _id: this.project._id,\n        permissions: {\n          canRead: streamCanRead,\n          canWrite: streamCanWrite\n        },\n        canRead: localCanRead,\n        canWrite: localCanWrite\n      });\n    },\n    changePermissionStreams: function changePermissionStreams(userId) {\n      var hasWritePermission = this.project.permissions.canWrite.indexOf(userId) > -1 ? true : false;\n      if (!hasWritePermission) this.upgradeUser(userId);else this.downgradeUser(userId);\n    },\n    upgradeUser: function upgradeUser(userId) {\n      this.$store.dispatch('upgradeUserInProject', {\n        projectId: this.project._id,\n        userId: userId\n      });\n    },\n    downgradeUser: function downgradeUser(userId) {\n      this.$store.dispatch('downgradeUserInProject', {\n        projectId: this.project._id,\n        userId: userId\n      });\n    },\n    removeUser: function removeUser(userId) {\n      this.$store.dispatch('removeUserInProject', {\n        projectId: this.project._id,\n        userId: userId\n      });\n    }\n  },\n  mounted: function mounted() {}\n};",{"version":3,"sources":["PermissionTableProject.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\n  <v-container grid-list-sm v-if='allUsersPop.length > 0 && project' class='pa-0 ma-0'>\n    <v-layout row wrap>\n      <v-flex xs12 v-if='!canEdit'>You cannot add users to this project.</v-flex>\n      <v-flex xs12 v-for='user in allUsersPop' v-if='user' :key='user._id'>\n        <user-perm-card\n        @change-permission-streams='changePermissionStreams'\n        @change-permission-project='changePermissionProject'\n        @remove-user='removeUser'\n        :user='user' :project='project' :global-disabled='globalDisabled'></user-perm-card>\n      </v-flex>\n    </v-layout>\n  </v-container>\n</template>\n<script>\nimport union from 'lodash.union'\nimport uniq from 'lodash.uniq'\n\nimport UserPermCard from '@/components/UserPermissionProjectCard.vue'\n\nexport default {\n  name: 'PermissionTable',\n  components: {\n    UserPermCard\n  },\n  props: {\n    project: Object,\n    globalDisabled: {\n      type: Boolean,\n      default: false\n    }\n  },\n  computed: {\n    canEdit( ) {\n      return this.project.owner === this.$store.state.user._id || this.project.canWrite.indexOf( this.$store.state.user._id ) > -1 || this.$store.state.user.role === 'admin'\n    },\n    canReadProject( ) { return this.project.canRead },\n    canWriteProject( ) { return this.project.canWrite },\n    canReadStreams( ) { return this.project.permissions.canRead },\n    canWriteStreams( ) { return this.project.permissions.canWrite },\n    allUsers( ) {\n      return uniq( [ ...this.canReadProject, ...this.canWriteProject, ...this.canReadStreams, ...this.canWriteProject, this.project.owner ] )\n    },\n    allUsersPop( ) {\n      if ( this.allUsers.length === 0 ) return [ ]\n      return this.allUsers.map( userId => {\n        let u = this.$store.state.users.find( user => user._id === userId )\n        if ( !u ) this.$store.dispatch( 'getUser', { _id: userId } )\n        if ( u ) u.isOwner = u._id === this.project.owner\n        return u\n      } ) //.sort( ( a, b ) => a.name > b.name ? 1 : -1 )\n    }\n  },\n  data( ) {\n    return {}\n  },\n  methods: {\n    hasWritePermissionStreams( _id ) {\n      return this.canWriteStreams.indexOf( _id ) > -1\n    },\n    hasWritePermissionProject( _id ) {\n      return this.canWriteProject.indexOf( _id ) > -1\n    },\n    changePermissionProject( userId ) {\n      let canWrite = this.project.canWrite.indexOf( userId ) > -1 ? true : false\n      let localCanWrite = [ ],\n        localCanRead = [ ],\n        streamCanWrite = this.project.permissions.canWrite,\n        streamCanRead = this.project.permissions.canRead\n\n      if ( canWrite ) {\n        localCanWrite = this.project.canWrite.filter( uId => uId !== userId )\n        localCanRead = uniq( [ ...this.project.canRead, userId ] )\n      } else {\n        localCanRead = this.project.canRead\n        localCanWrite = uniq( [ ...this.project.canWrite, userId ] )\n        // TODO: UPGRADE STREAMS CANWRITE TOO (otherwise user x can edit the project but not do much)\n        streamCanWrite = uniq( [ ...streamCanWrite, userId ] )\n        this.upgradeUser( userId )\n      }\n      this.$store.dispatch( 'updateProject', { _id: this.project._id, permissions: { canRead: streamCanRead, canWrite: streamCanWrite }, canRead: localCanRead, canWrite: localCanWrite } )\n    },\n    changePermissionStreams( userId ) {\n      let hasWritePermission = this.project.permissions.canWrite.indexOf( userId ) > -1 ? true : false\n      if ( !hasWritePermission ) this.upgradeUser( userId )\n      else this.downgradeUser( userId )\n    },\n    upgradeUser( userId ) {\n      this.$store.dispatch( 'upgradeUserInProject', { projectId: this.project._id, userId: userId } )\n    },\n    downgradeUser( userId ) {\n      this.$store.dispatch( 'downgradeUserInProject', { projectId: this.project._id, userId: userId } )\n    },\n    removeUser( userId ) {\n      this.$store.dispatch( 'removeUserInProject', { projectId: this.project._id, userId: userId } )\n    }\n  },\n  mounted( ) {}\n}\n\n</script>\n<style scoped lang='scss'>\n.user {\n  padding: 2px 10px;\n}\n\n</style>\n"],"sourceRoot":"src/components"}]}